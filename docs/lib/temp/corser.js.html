<!DOCTYPE html><html><head><title>corser.js</title><meta http-equiv="Content-Type" content="text/html" charset="UTF-8"><link rel="stylesheet" media="all" href="../../docco.css"></head><body><div id="container"><div id="background"></div><div id="jump_to">Jump To &hellip;<div id="jump_wrapper"><div id="jump_page"><a href="../../index.html" class="source"><span class="file_name">README</span></a><a href="../../Authenticator.js.html" class="source "><span class="base_path">. / </span><span class="file_name">Authenticator.js</span></a><a href="../../Bootstrap.js.html" class="source "><span class="base_path">. / </span><span class="file_name">Bootstrap.js</span></a><a href="../../Dummy.js.html" class="source "><span class="base_path">. / </span><span class="file_name">Dummy.js</span></a><a href="../../FileServer.js.html" class="source "><span class="base_path">. / </span><span class="file_name">FileServer.js</span></a><a href="../../GetHandler.js.html" class="source "><span class="base_path">. / </span><span class="file_name">GetHandler.js</span></a><a href="../../Gruntfile.js.html" class="source "><span class="base_path">. / </span><span class="file_name">Gruntfile.js</span></a><a href="../../JSONHandler.js.html" class="source "><span class="base_path">. / </span><span class="file_name">JSONHandler.js</span></a><a href="../../PostHandler.js.html" class="source "><span class="base_path">. / </span><span class="file_name">PostHandler.js</span></a><a href="../../ResponseRenderer.js.html" class="source "><span class="base_path">. / </span><span class="file_name">ResponseRenderer.js</span></a><a href="../../Seki.js.html" class="source "><span class="base_path">. / </span><span class="file_name">Seki.js</span></a><a href="../../SourceHook.js.html" class="source "><span class="base_path">. / </span><span class="file_name">SourceHook.js</span></a><a href="../../SparqlUtils.js.html" class="source "><span class="base_path">. / </span><span class="file_name">SparqlUtils.js</span></a><a href="../../StoreClient.js.html" class="source "><span class="base_path">. / </span><span class="file_name">StoreClient.js</span></a><a href="../../TryJsonld.js.html" class="source "><span class="base_path">. / </span><span class="file_name">TryJsonld.js</span></a><a href="../../TurtleHandler.js.html" class="source "><span class="base_path">. / </span><span class="file_name">TurtleHandler.js</span></a><a href="../../Utils.js.html" class="source "><span class="base_path">. / </span><span class="file_name">Utils.js</span></a><a href="../../admin/FileReader.js.html" class="source "><span class="base_path">admin / </span><span class="file_name">FileReader.js</span></a><a href="../../admin/Admin.js.html" class="source "><span class="base_path">admin / </span><span class="file_name">Admin.js</span></a><a href="../../config/ConfigCustom.js.html" class="source "><span class="base_path">config / </span><span class="file_name">ConfigCustom.js</span></a><a href="../../config/Constants.js.html" class="source "><span class="base_path">config / </span><span class="file_name">Constants.js</span></a><a href="../../config/Headers.js.html" class="source "><span class="base_path">config / </span><span class="file_name">Headers.js</span></a><a href="../../config/Special.js.html" class="source "><span class="base_path">config / </span><span class="file_name">Special.js</span></a><a href="../../config/ConfigDefault.js.html" class="source "><span class="base_path">config / </span><span class="file_name">ConfigDefault.js</span></a><a href="../../config/ConfigOpenShift.js.html" class="source "><span class="base_path">config / </span><span class="file_name">ConfigOpenShift.js</span></a><a href="../../handlers/GetJsonHandler.js.html" class="source "><span class="base_path">handlers / </span><span class="file_name">GetJsonHandler.js</span></a><a href="../../handlers/VieJsonHandler.js.html" class="source "><span class="base_path">handlers / </span><span class="file_name">VieJsonHandler.js</span></a><a href="../../handlers/GetBlogHandler.js.html" class="source "><span class="base_path">handlers / </span><span class="file_name">GetBlogHandler.js</span></a><a href="../../lib/node-rdf/test/graph-TripletGraph-test.js.html" class="source "><span class="base_path">lib / node-rdf / test / </span><span class="file_name">graph-TripletGraph-test.js</span></a><a href="../../lib/node-rdf/test/builtins-String-test.js.html" class="source "><span class="base_path">lib / node-rdf / test / </span><span class="file_name">builtins-String-test.js</span></a><a href="../../lib/node-rdf/test/builtins-ref-test.js.html" class="source "><span class="base_path">lib / node-rdf / test / </span><span class="file_name">builtins-ref-test.js</span></a><a href="../../lib/node-rdf/test/parser-Turtle-test.js.html" class="source "><span class="base_path">lib / node-rdf / test / </span><span class="file_name">parser-Turtle-test.js</span></a><a href="../../lib/node-rdf/test/RDFEnvironment-test.js.html" class="source "><span class="base_path">lib / node-rdf / test / </span><span class="file_name">RDFEnvironment-test.js</span></a><a href="../../lib/node-rdf/test/IRI-test.js.html" class="source "><span class="base_path">lib / node-rdf / test / </span><span class="file_name">IRI-test.js</span></a><a href="../../lib/node-rdf/test/context-resolve-test.js.html" class="source "><span class="base_path">lib / node-rdf / test / </span><span class="file_name">context-resolve-test.js</span></a><a href="../../lib/node-rdf/test/builtins-Number-test.js.html" class="source "><span class="base_path">lib / node-rdf / test / </span><span class="file_name">builtins-Number-test.js</span></a><a href="../../lib/node-rdf/test/context-convert-test.js.html" class="source "><span class="base_path">lib / node-rdf / test / </span><span class="file_name">context-convert-test.js</span></a><a href="../../lib/node-rdf/test/graph-IndexedGraph-test.js.html" class="source "><span class="base_path">lib / node-rdf / test / </span><span class="file_name">graph-IndexedGraph-test.js</span></a><a href="../../lib/node-rdf/test/graph-test-lib.js.html" class="source "><span class="base_path">lib / node-rdf / test / </span><span class="file_name">graph-test-lib.js</span></a><a href="../../lib/node-rdf/lib/rdf.js.html" class="source "><span class="base_path">lib / node-rdf / lib / </span><span class="file_name">rdf.js</span></a><a href="../../lib/node-rdf/lib/TripletGraph.js.html" class="source "><span class="base_path">lib / node-rdf / lib / </span><span class="file_name">TripletGraph.js</span></a><a href="../../lib/node-rdf/lib/Graph.js.html" class="source "><span class="base_path">lib / node-rdf / lib / </span><span class="file_name">Graph.js</span></a><a href="../../lib/node-rdf/lib/IndexedGraph.js.html" class="source "><span class="base_path">lib / node-rdf / lib / </span><span class="file_name">IndexedGraph.js</span></a><a href="../../lib/node-rdf/lib/RDFNode.js.html" class="source "><span class="base_path">lib / node-rdf / lib / </span><span class="file_name">RDFNode.js</span></a><a href="../../lib/node-rdf/lib/Builtins.js.html" class="source "><span class="base_path">lib / node-rdf / lib / </span><span class="file_name">Builtins.js</span></a><a href="../../lib/node-rdf/lib/Profile.js.html" class="source "><span class="base_path">lib / node-rdf / lib / </span><span class="file_name">Profile.js</span></a><a href="../../lib/node-rdf/lib/Default.js.html" class="source "><span class="base_path">lib / node-rdf / lib / </span><span class="file_name">Default.js</span></a><a href="../../lib/node-rdf/lib/RDFEnvironment.js.html" class="source "><span class="base_path">lib / node-rdf / lib / </span><span class="file_name">RDFEnvironment.js</span></a><a href="../../lib/node-rdf/lib/N3Serializer.js.html" class="source "><span class="base_path">lib / node-rdf / lib / </span><span class="file_name">N3Serializer.js</span></a><a href="../../lib/node-rdf/lib/TurtleParser.js.html" class="source "><span class="base_path">lib / node-rdf / lib / </span><span class="file_name">TurtleParser.js</span></a><a href="../../lib/temp/corser.js.html" class="source selected"><span class="base_path">lib / temp / </span><span class="file_name">corser.js</span></a><a href="../../lib/temp/connect-cors.js.html" class="source "><span class="base_path">lib / temp / </span><span class="file_name">connect-cors.js</span></a><a href="../../lib/jsonld/jsonld.js.html" class="source "><span class="base_path">lib / jsonld / </span><span class="file_name">jsonld.js</span></a><a href="../../lib/jsonld/request.js.html" class="source "><span class="base_path">lib / jsonld / </span><span class="file_name">request.js</span></a><a href="../../lib/jsonld/Future.js.html" class="source "><span class="base_path">lib / jsonld / </span><span class="file_name">Future.js</span></a><a href="../../lib/jsonld/rdfa.js.html" class="source "><span class="base_path">lib / jsonld / </span><span class="file_name">rdfa.js</span></a><a href="../../misc/sr.js.html" class="source "><span class="base_path">misc / </span><span class="file_name">sr.js</span></a><a href="../../misc/biscuit.js.html" class="source "><span class="base_path">misc / </span><span class="file_name">biscuit.js</span></a><a href="../../misc/router.js.html" class="source "><span class="base_path">misc / </span><span class="file_name">router.js</span></a><a href="../../misc/cors-client-snippet.js.html" class="source "><span class="base_path">misc / </span><span class="file_name">cors-client-snippet.js</span></a><a href="../../misc/flatten-map.js.html" class="source "><span class="base_path">misc / </span><span class="file_name">flatten-map.js</span></a><a href="../../misc/mimeToJSON.js.html" class="source "><span class="base_path">misc / </span><span class="file_name">mimeToJSON.js</span></a><a href="../../misc/htmlparser.js.html" class="source "><span class="base_path">misc / </span><span class="file_name">htmlparser.js</span></a><a href="../../misc/shortener.js.html" class="source "><span class="base_path">misc / </span><span class="file_name">shortener.js</span></a><a href="../../misc/html5-boilerplate.js.html" class="source "><span class="base_path">misc / </span><span class="file_name">html5-boilerplate.js</span></a><a href="../../srx2map.js.html" class="source "><span class="base_path">. / </span><span class="file_name">srx2map.js</span></a><a href="../../srx2map_multi.js.html" class="source "><span class="base_path">. / </span><span class="file_name">srx2map_multi.js</span></a><a href="../../templates/SparqlTemplates.js.html" class="source "><span class="base_path">templates / </span><span class="file_name">SparqlTemplates.js</span></a><a href="../../templates/JsonTemplates.js.html" class="source "><span class="base_path">templates / </span><span class="file_name">JsonTemplates.js</span></a><a href="../../templates/Templater.js.html" class="source "><span class="base_path">templates / </span><span class="file_name">Templater.js</span></a><a href="../../templates/SparqlUserTemplates.js.html" class="source "><span class="base_path">templates / </span><span class="file_name">SparqlUserTemplates.js</span></a><a href="../../templates/HtmlTemplates.js.html" class="source "><span class="base_path">templates / </span><span class="file_name">HtmlTemplates.js</span></a><a href="../../templates/freemarker.js.html" class="source "><span class="base_path">templates / </span><span class="file_name">freemarker.js</span></a><a href="../../tests/run-tests.js.html" class="source "><span class="base_path">tests / </span><span class="file_name">run-tests.js</span></a><a href="../../tests/old/allTests.js.html" class="source "><span class="base_path">tests / old / </span><span class="file_name">allTests.js</span></a><a href="../../tests/old/testRdfHttp.js.html" class="source "><span class="base_path">tests / old / </span><span class="file_name">testRdfHttp.js</span></a><a href="../../tests/old/dummyServer.js.html" class="source "><span class="base_path">tests / old / </span><span class="file_name">dummyServer.js</span></a><a href="../../tests/old/testTemplater.js.html" class="source "><span class="base_path">tests / old / </span><span class="file_name">testTemplater.js</span></a><a href="../../tests/old/testHelpers.js.html" class="source "><span class="base_path">tests / old / </span><span class="file_name">testHelpers.js</span></a><a href="../../usermanager/users.js.html" class="source "><span class="base_path">usermanager / </span><span class="file_name">users.js</span></a><a href="../../wat.js.html" class="source "><span class="base_path">. / </span><span class="file_name">wat.js</span></a></div></div></div><table cellpadding="0" cellspacing="0"><thead><tr><th class="docs"><h1>corser.js</h1><div class="filepath">lib/temp/</div></th><th class="code"></th></tr></thead><tbody><tr id="section-1"><td class="docs"><div class="pilwrap"><a href="#section-1" class="pilcrow">&#182;</a></div><div class="dox"><div class="summary"><p>Specification: <a href='http://www.w3.org/TR/2012/WD-cors-20120403/'>http://www.w3.org/TR/2012/WD-cors-20120403/</a><br />W3C Working Draft 3 April 2012</p></div><div class="body"></div></div>
</td><td class="code"><div class="highlight"><pre><span class="s2">&quot;use strict&quot;</span><span class="p">;</span></pre></div></td></tr><tr id="section-2"><td class="docs"><div class="pilwrap"><a href="#section-2" class="pilcrow">&#182;</a></div><div class="dox"><div class="summary"><p>shint node:true</p></div><div class="body"></div></div>
</td><td class="code"><div class="highlight"><pre><span class="kd">var</span> <span class="nx">simpleMethods</span><span class="p">,</span> <span class="nx">simpleRequestHeaders</span><span class="p">,</span> <span class="nx">simpleResponseHeaders</span><span class="p">,</span> <span class="nx">toLowerCase</span><span class="p">,</span> <span class="nx">checkOriginMatch</span><span class="p">;</span></pre></div></td></tr><tr id="section-3"><td class="docs"><div class="pilwrap"><a href="#section-3" class="pilcrow">&#182;</a></div><p>A method is said to be a simple method if it is a case-sensitive match for one of the following:</p>
</td><td class="code"><div class="highlight"><pre><span class="nb">Object</span><span class="p">.</span><span class="nx">defineProperty</span><span class="p">(</span><span class="nx">exports</span><span class="p">,</span> <span class="s2">&quot;simpleMethods&quot;</span><span class="p">,</span> <span class="p">{</span>
    <span class="nx">get</span><span class="o">:</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
        <span class="k">return</span> <span class="p">[</span>
            <span class="s2">&quot;GET&quot;</span><span class="p">,</span>
            <span class="s2">&quot;HEAD&quot;</span><span class="p">,</span>
            <span class="s2">&quot;POST&quot;</span>
        <span class="p">];</span>
    <span class="p">}</span>
<span class="p">});</span>
<span class="nx">simpleMethods</span> <span class="o">=</span> <span class="nx">exports</span><span class="p">.</span><span class="nx">simpleMethods</span><span class="p">;</span></pre></div></td></tr><tr id="section-4"><td class="docs"><div class="pilwrap"><a href="#section-4" class="pilcrow">&#182;</a></div><p>A header is said to be a simple header if the header field name is an ASCII case-insensitive match for one of
the following:</p>
</td><td class="code"><div class="highlight"><pre><span class="nb">Object</span><span class="p">.</span><span class="nx">defineProperty</span><span class="p">(</span><span class="nx">exports</span><span class="p">,</span> <span class="s2">&quot;simpleRequestHeaders&quot;</span><span class="p">,</span> <span class="p">{</span>
    <span class="nx">get</span><span class="o">:</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
        <span class="k">return</span> <span class="p">[</span>
            <span class="s2">&quot;accept&quot;</span><span class="p">,</span>
            <span class="s2">&quot;accept-language&quot;</span><span class="p">,</span>
            <span class="s2">&quot;content-language&quot;</span><span class="p">,</span>
            <span class="s2">&quot;content-type&quot;</span>
        <span class="p">];</span>
    <span class="p">}</span>
<span class="p">});</span>
<span class="nx">simpleRequestHeaders</span> <span class="o">=</span> <span class="nx">exports</span><span class="p">.</span><span class="nx">simpleRequestHeaders</span><span class="p">;</span></pre></div></td></tr><tr id="section-5"><td class="docs"><div class="pilwrap"><a href="#section-5" class="pilcrow">&#182;</a></div><p>A header is said to be a simple response header if the header field name is an ASCII case-insensitive
match for one of the following:</p>
</td><td class="code"><div class="highlight"><pre><span class="nb">Object</span><span class="p">.</span><span class="nx">defineProperty</span><span class="p">(</span><span class="nx">exports</span><span class="p">,</span> <span class="s2">&quot;simpleResponseHeaders&quot;</span><span class="p">,</span> <span class="p">{</span>
    <span class="nx">get</span><span class="o">:</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
        <span class="k">return</span> <span class="p">[</span>
            <span class="s2">&quot;cache-control&quot;</span><span class="p">,</span>
            <span class="s2">&quot;content-language&quot;</span><span class="p">,</span>
            <span class="s2">&quot;content-type&quot;</span><span class="p">,</span>
            <span class="s2">&quot;expires&quot;</span><span class="p">,</span>
            <span class="s2">&quot;last-modified&quot;</span><span class="p">,</span>
            <span class="s2">&quot;pragma&quot;</span>
        <span class="p">];</span>
    <span class="p">}</span>
<span class="p">});</span>
<span class="nx">simpleResponseHeaders</span> <span class="o">=</span> <span class="nx">exports</span><span class="p">.</span><span class="nx">simpleResponseHeaders</span><span class="p">;</span>

<span class="nx">toLowerCase</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">array</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">return</span> <span class="nx">array</span><span class="p">.</span><span class="nx">map</span><span class="p">(</span><span class="kd">function</span> <span class="p">(</span><span class="nx">el</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">return</span> <span class="nx">el</span><span class="p">.</span><span class="nx">toLowerCase</span><span class="p">();</span>
    <span class="p">});</span>
<span class="p">};</span>

<span class="nx">checkOriginMatch</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">originHeader</span><span class="p">,</span> <span class="nx">origins</span><span class="p">,</span> <span class="nx">callback</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">originMatches</span><span class="p">;</span>
    <span class="nx">originMatches</span> <span class="o">=</span> <span class="kc">false</span><span class="p">;</span>
    <span class="k">if</span> <span class="p">(</span><span class="k">typeof</span> <span class="nx">origins</span> <span class="o">===</span> <span class="s2">&quot;function&quot;</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">origins</span><span class="p">(</span><span class="nx">originHeader</span><span class="p">,</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">allow</span><span class="p">)</span> <span class="p">{</span>
            <span class="nx">callback</span><span class="p">(</span><span class="nx">allow</span><span class="p">);</span>
        <span class="p">});</span>
    <span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="nx">origins</span><span class="p">.</span><span class="nx">length</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">callback</span><span class="p">(</span><span class="nx">origins</span><span class="p">.</span><span class="nx">some</span><span class="p">(</span><span class="kd">function</span> <span class="p">(</span><span class="nx">origin</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">return</span> <span class="nx">origin</span> <span class="o">===</span> <span class="nx">originHeader</span><span class="p">;</span>
        <span class="p">}));</span>
    <span class="p">}</span> <span class="k">else</span> <span class="p">{</span></pre></div></td></tr><tr id="section-6"><td class="docs"><div class="pilwrap"><a href="#section-6" class="pilcrow">&#182;</a></div><p>Always matching is acceptable since the list of origins can be unbounded.</p>
</td><td class="code"><div class="highlight"><pre>        <span class="nx">callback</span><span class="p">(</span><span class="kc">true</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">};</span>

<span class="nx">exports</span><span class="p">.</span><span class="nx">create</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">options</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">options</span> <span class="o">=</span> <span class="nx">options</span> <span class="o">||</span> <span class="p">{};</span>
    <span class="nx">options</span><span class="p">.</span><span class="nx">origins</span> <span class="o">=</span> <span class="nx">options</span><span class="p">.</span><span class="nx">origins</span> <span class="o">||</span> <span class="p">[];</span>
    <span class="nx">options</span><span class="p">.</span><span class="nx">methods</span> <span class="o">=</span> <span class="nx">options</span><span class="p">.</span><span class="nx">methods</span> <span class="o">||</span> <span class="nx">simpleMethods</span><span class="p">;</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">options</span><span class="p">.</span><span class="nx">hasOwnProperty</span><span class="p">(</span><span class="s2">&quot;requestHeaders&quot;</span><span class="p">)</span> <span class="o">===</span> <span class="kc">true</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">options</span><span class="p">.</span><span class="nx">requestHeaders</span> <span class="o">=</span> <span class="nx">toLowerCase</span><span class="p">(</span><span class="nx">options</span><span class="p">.</span><span class="nx">requestHeaders</span><span class="p">);</span>
    <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
        <span class="nx">options</span><span class="p">.</span><span class="nx">requestHeaders</span> <span class="o">=</span> <span class="nx">simpleRequestHeaders</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">options</span><span class="p">.</span><span class="nx">hasOwnProperty</span><span class="p">(</span><span class="s2">&quot;responseHeaders&quot;</span><span class="p">)</span> <span class="o">===</span> <span class="kc">true</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">options</span><span class="p">.</span><span class="nx">responseHeaders</span> <span class="o">=</span> <span class="nx">toLowerCase</span><span class="p">(</span><span class="nx">options</span><span class="p">.</span><span class="nx">responseHeaders</span><span class="p">);</span>
    <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
        <span class="nx">options</span><span class="p">.</span><span class="nx">responseHeaders</span> <span class="o">=</span> <span class="nx">simpleResponseHeaders</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="nx">options</span><span class="p">.</span><span class="nx">maxAge</span> <span class="o">=</span> <span class="nx">options</span><span class="p">.</span><span class="nx">maxAge</span> <span class="o">||</span> <span class="kc">null</span><span class="p">;</span>
    <span class="nx">options</span><span class="p">.</span><span class="nx">supportsCredentials</span> <span class="o">=</span> <span class="nx">options</span><span class="p">.</span><span class="nx">supportsCredentials</span> <span class="o">||</span> <span class="kc">false</span><span class="p">;</span>
    <span class="k">return</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">req</span><span class="p">,</span> <span class="nx">res</span><span class="p">,</span> <span class="nx">next</span><span class="p">)</span> <span class="p">{</span>
        <span class="kd">var</span> <span class="nx">methodMatches</span><span class="p">,</span> <span class="nx">headersMatch</span><span class="p">,</span> <span class="nx">requestMethod</span><span class="p">,</span> <span class="nx">requestHeaders</span><span class="p">,</span> <span class="nx">exposedHeaders</span><span class="p">;</span></pre></div></td></tr><tr id="section-7"><td class="docs"><div class="pilwrap"><a href="#section-7" class="pilcrow">&#182;</a></div><p>If the Origin header is not present terminate this set of steps.</p>
</td><td class="code"><div class="highlight"><pre>        <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">req</span><span class="p">.</span><span class="nx">headers</span><span class="p">.</span><span class="nx">hasOwnProperty</span><span class="p">(</span><span class="s2">&quot;origin&quot;</span><span class="p">))</span> <span class="p">{</span></pre></div></td></tr><tr id="section-8"><td class="docs"><div class="pilwrap"><a href="#section-8" class="pilcrow">&#182;</a></div><p>The request is outside the scope of the CORS specification. If there is no Origin header,
it could be a same-origin request. Let's let the user-agent handle this situation.</p>
</td><td class="code"><div class="highlight"><pre>            <span class="nx">next</span><span class="p">();</span>
        <span class="p">}</span> <span class="k">else</span> <span class="p">{</span></pre></div></td></tr><tr id="section-9"><td class="docs"><div class="pilwrap"><a href="#section-9" class="pilcrow">&#182;</a></div><p>If the value of the Origin header is not a case-sensitive match for any of the values in
list of origins, do not set any additional headers and terminate this set of steps.</p>
</td><td class="code"><div class="highlight"><pre>            <span class="nx">checkOriginMatch</span><span class="p">(</span><span class="nx">req</span><span class="p">.</span><span class="nx">headers</span><span class="p">.</span><span class="nx">origin</span><span class="p">,</span> <span class="nx">options</span><span class="p">.</span><span class="nx">origins</span><span class="p">,</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">originMatches</span><span class="p">)</span> <span class="p">{</span>
                <span class="k">if</span> <span class="p">(</span><span class="nx">originMatches</span> <span class="o">===</span> <span class="kc">false</span><span class="p">)</span> <span class="p">{</span>
                    <span class="nx">next</span><span class="p">();</span>
                <span class="p">}</span> <span class="k">else</span> <span class="p">{</span></pre></div></td></tr><tr id="section-10"><td class="docs"><div class="pilwrap"><a href="#section-10" class="pilcrow">&#182;</a></div><p>Respond to preflight request.</p>
</td><td class="code"><div class="highlight"><pre>                    <span class="k">if</span> <span class="p">(</span><span class="nx">req</span><span class="p">.</span><span class="nx">method</span> <span class="o">===</span> <span class="s2">&quot;OPTIONS&quot;</span><span class="p">)</span> <span class="p">{</span></pre></div></td></tr><tr id="section-11"><td class="docs"><div class="pilwrap"><a href="#section-11" class="pilcrow">&#182;</a></div><p>If there is no Access-Control-Request-Method header or if parsing failed, do not set
any additional headers and terminate this set of steps.</p>
</td><td class="code"><div class="highlight"><pre>                        <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">req</span><span class="p">.</span><span class="nx">headers</span><span class="p">.</span><span class="nx">hasOwnProperty</span><span class="p">(</span><span class="s2">&quot;access-control-request-method&quot;</span><span class="p">))</span> <span class="p">{</span>
                            <span class="nx">next</span><span class="p">();</span>
                        <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
                            <span class="nx">requestMethod</span> <span class="o">=</span> <span class="nx">req</span><span class="p">.</span><span class="nx">headers</span><span class="p">[</span><span class="s2">&quot;access-control-request-method&quot;</span><span class="p">];</span></pre></div></td></tr><tr id="section-12"><td class="docs"><div class="pilwrap"><a href="#section-12" class="pilcrow">&#182;</a></div><p>If there are no Access-Control-Request-Headers headers let header field-names be the
empty list. If parsing failed do not set any additional headers and terminate this set
of steps.</p>
</td><td class="code"><div class="highlight"><pre>                            <span class="k">if</span> <span class="p">(</span><span class="nx">req</span><span class="p">.</span><span class="nx">headers</span><span class="p">.</span><span class="nx">hasOwnProperty</span><span class="p">(</span><span class="s2">&quot;access-control-request-headers&quot;</span><span class="p">))</span> <span class="p">{</span>
                                <span class="nx">requestHeaders</span> <span class="o">=</span> <span class="nx">toLowerCase</span><span class="p">(</span><span class="nx">req</span><span class="p">.</span><span class="nx">headers</span><span class="p">[</span><span class="s2">&quot;access-control-request-headers&quot;</span><span class="p">].</span><span class="nx">split</span><span class="p">(</span><span class="sr">/,\s*/</span><span class="p">));</span>
                            <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
                                <span class="nx">requestHeaders</span> <span class="o">=</span> <span class="p">[];</span>
                            <span class="p">}</span></pre></div></td></tr><tr id="section-13"><td class="docs"><div class="pilwrap"><a href="#section-13" class="pilcrow">&#182;</a></div><p>If method is not a case-sensitive match for any of the values in list of methods do not
set any additional headers and terminate this set of steps.</p>
</td><td class="code"><div class="highlight"><pre>                            <span class="nx">methodMatches</span> <span class="o">=</span> <span class="nx">options</span><span class="p">.</span><span class="nx">methods</span><span class="p">.</span><span class="nx">indexOf</span><span class="p">(</span><span class="nx">requestMethod</span><span class="p">)</span> <span class="o">!==</span> <span class="o">-</span><span class="mi">1</span><span class="p">;</span>
                            <span class="k">if</span> <span class="p">(</span><span class="nx">methodMatches</span> <span class="o">===</span> <span class="kc">false</span><span class="p">)</span> <span class="p">{</span>
                                <span class="nx">next</span><span class="p">();</span>
                            <span class="p">}</span> <span class="k">else</span> <span class="p">{</span></pre></div></td></tr><tr id="section-14"><td class="docs"><div class="pilwrap"><a href="#section-14" class="pilcrow">&#182;</a></div><p>If any of the header field-names is not a ASCII case-insensitive match for any of
the values in list of headers do not set any additional headers and terminate this
set of steps.</p>
</td><td class="code"><div class="highlight"><pre>                                <span class="nx">headersMatch</span> <span class="o">=</span> <span class="nx">requestHeaders</span><span class="p">.</span><span class="nx">every</span><span class="p">(</span><span class="kd">function</span> <span class="p">(</span><span class="nx">requestHeader</span><span class="p">)</span> <span class="p">{</span></pre></div></td></tr><tr id="section-15"><td class="docs"><div class="pilwrap"><a href="#section-15" class="pilcrow">&#182;</a></div><p>Browsers automatically add Origin to Access-Control-Request-Headers. However,
Origin is not one of the simple request headers. Therefore, the header is
accepted even if it is not in the list of request headers because CORS would
not work without it.</p>
</td><td class="code"><div class="highlight"><pre>                                    <span class="k">if</span> <span class="p">(</span><span class="nx">requestHeader</span> <span class="o">===</span> <span class="s2">&quot;origin&quot;</span><span class="p">)</span> <span class="p">{</span>
                                        <span class="k">return</span> <span class="kc">true</span><span class="p">;</span>
                                    <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
                                        <span class="k">if</span> <span class="p">(</span><span class="nx">options</span><span class="p">.</span><span class="nx">requestHeaders</span><span class="p">.</span><span class="nx">indexOf</span><span class="p">(</span><span class="nx">requestHeader</span><span class="p">)</span> <span class="o">!==</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="p">{</span>
                                            <span class="k">return</span> <span class="kc">true</span><span class="p">;</span>
                                        <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
                                            <span class="k">return</span> <span class="kc">false</span><span class="p">;</span>
                                        <span class="p">}</span>
                                    <span class="p">}</span>
                                <span class="p">});</span>
                                <span class="k">if</span> <span class="p">(</span><span class="nx">headersMatch</span> <span class="o">===</span> <span class="kc">false</span><span class="p">)</span> <span class="p">{</span>
                                    <span class="nx">next</span><span class="p">();</span>
                                <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
                                    <span class="k">if</span> <span class="p">(</span><span class="nx">options</span><span class="p">.</span><span class="nx">supportsCredentials</span> <span class="o">===</span> <span class="kc">true</span><span class="p">)</span> <span class="p">{</span></pre></div></td></tr><tr id="section-16"><td class="docs"><div class="pilwrap"><a href="#section-16" class="pilcrow">&#182;</a></div><p>If the resource supports credentials add a single Access-Control-Allow-Origin
header, with the value of the Origin header as value, and add a single
Access-Control-Allow-Credentials header with the literal string "true"
as value.</p>
</td><td class="code"><div class="highlight"><pre>                                        <span class="nx">res</span><span class="p">.</span><span class="nx">setHeader</span><span class="p">(</span><span class="s2">&quot;Access-Control-Allow-Origin&quot;</span><span class="p">,</span> <span class="nx">req</span><span class="p">.</span><span class="nx">headers</span><span class="p">.</span><span class="nx">origin</span><span class="p">);</span>
                                        <span class="nx">res</span><span class="p">.</span><span class="nx">setHeader</span><span class="p">(</span><span class="s2">&quot;Access-Control-Allow-Credentials&quot;</span><span class="p">,</span> <span class="s2">&quot;true&quot;</span><span class="p">);</span>
                                    <span class="p">}</span> <span class="k">else</span> <span class="p">{</span></pre></div></td></tr><tr id="section-17"><td class="docs"><div class="pilwrap"><a href="#section-17" class="pilcrow">&#182;</a></div><p>Otherwise, add a single Access-Control-Allow-Origin header, with either the
value of the Origin header or the string "*" as value.</p>
</td><td class="code"><div class="highlight"><pre>                                        <span class="k">if</span> <span class="p">(</span><span class="nx">options</span><span class="p">.</span><span class="nx">origins</span><span class="p">.</span><span class="nx">length</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="o">||</span> <span class="k">typeof</span> <span class="nx">options</span><span class="p">.</span><span class="nx">origins</span> <span class="o">===</span> <span class="s2">&quot;function&quot;</span><span class="p">)</span> <span class="p">{</span>
                                            <span class="nx">res</span><span class="p">.</span><span class="nx">setHeader</span><span class="p">(</span><span class="s2">&quot;Access-Control-Allow-Origin&quot;</span><span class="p">,</span> <span class="nx">req</span><span class="p">.</span><span class="nx">headers</span><span class="p">.</span><span class="nx">origin</span><span class="p">);</span>
                                        <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
                                            <span class="nx">res</span><span class="p">.</span><span class="nx">setHeader</span><span class="p">(</span><span class="s2">&quot;Access-Control-Allow-Origin&quot;</span><span class="p">,</span> <span class="s2">&quot;*&quot;</span><span class="p">);</span>
                                        <span class="p">}</span>
                                    <span class="p">}</span></pre></div></td></tr><tr id="section-18"><td class="docs"><div class="pilwrap"><a href="#section-18" class="pilcrow">&#182;</a></div><p>Optionally add a single Access-Control-Max-Age header with as value the amount
of seconds the user agent is allowed to cache the result of the request.</p>
</td><td class="code"><div class="highlight"><pre>                                    <span class="k">if</span> <span class="p">(</span><span class="nx">options</span><span class="p">.</span><span class="nx">maxAge</span> <span class="o">!==</span> <span class="kc">null</span><span class="p">)</span> <span class="p">{</span>
                                        <span class="nx">res</span><span class="p">.</span><span class="nx">setHeader</span><span class="p">(</span><span class="s2">&quot;Access-Control-Max-Age&quot;</span><span class="p">,</span> <span class="nx">options</span><span class="p">.</span><span class="nx">maxAge</span><span class="p">);</span>
                                    <span class="p">}</span></pre></div></td></tr><tr id="section-19"><td class="docs"><div class="pilwrap"><a href="#section-19" class="pilcrow">&#182;</a></div><p>Add one or more Access-Control-Allow-Methods headers consisting of (a subset
of) the list of methods.</p>
</td><td class="code"><div class="highlight"><pre>                                    <span class="nx">res</span><span class="p">.</span><span class="nx">setHeader</span><span class="p">(</span><span class="s2">&quot;Access-Control-Allow-Methods&quot;</span><span class="p">,</span> <span class="nx">options</span><span class="p">.</span><span class="nx">methods</span><span class="p">.</span><span class="nx">join</span><span class="p">(</span><span class="s2">&quot;,&quot;</span><span class="p">));</span></pre></div></td></tr><tr id="section-20"><td class="docs"><div class="pilwrap"><a href="#section-20" class="pilcrow">&#182;</a></div><p>Add one or more Access-Control-Allow-Headers headers consisting of (a subset
of) the list of headers.</p>
</td><td class="code"><div class="highlight"><pre>                                    <span class="nx">res</span><span class="p">.</span><span class="nx">setHeader</span><span class="p">(</span><span class="s2">&quot;Access-Control-Allow-Headers&quot;</span><span class="p">,</span> <span class="nx">options</span><span class="p">.</span><span class="nx">requestHeaders</span><span class="p">.</span><span class="nx">join</span><span class="p">(</span><span class="s2">&quot;,&quot;</span><span class="p">));</span></pre></div></td></tr><tr id="section-21"><td class="docs"><div class="pilwrap"><a href="#section-21" class="pilcrow">&#182;</a></div><p>And out.</p>
</td><td class="code"><div class="highlight"><pre>                                    <span class="nx">next</span><span class="p">();</span>
                                <span class="p">}</span>
                            <span class="p">}</span>
                        <span class="p">}</span>
                    <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
                        <span class="k">if</span> <span class="p">(</span><span class="nx">options</span><span class="p">.</span><span class="nx">supportsCredentials</span> <span class="o">===</span> <span class="kc">true</span><span class="p">)</span> <span class="p">{</span></pre></div></td></tr><tr id="section-22"><td class="docs"><div class="pilwrap"><a href="#section-22" class="pilcrow">&#182;</a></div><p>If the resource supports credentials add a single Access-Control-Allow-Origin header,
with the value of the Origin header as value, and add a single
Access-Control-Allow-Credentials header with the literal string "true" as value.</p>
</td><td class="code"><div class="highlight"><pre>                            <span class="nx">res</span><span class="p">.</span><span class="nx">setHeader</span><span class="p">(</span><span class="s2">&quot;Access-Control-Allow-Origin&quot;</span><span class="p">,</span> <span class="nx">req</span><span class="p">.</span><span class="nx">headers</span><span class="p">.</span><span class="nx">origin</span><span class="p">);</span>
                            <span class="nx">res</span><span class="p">.</span><span class="nx">setHeader</span><span class="p">(</span><span class="s2">&quot;Access-Control-Allow-Credentials&quot;</span><span class="p">,</span> <span class="s2">&quot;true&quot;</span><span class="p">);</span>
                        <span class="p">}</span> <span class="k">else</span> <span class="p">{</span></pre></div></td></tr><tr id="section-23"><td class="docs"><div class="pilwrap"><a href="#section-23" class="pilcrow">&#182;</a></div><p>Otherwise, add a single Access-Control-Allow-Origin header, with either the value of
the Origin header or the literal string "<em>" as value.
If the list of origins is empty, use "</em>" as value.</p>
</td><td class="code"><div class="highlight"><pre>                            <span class="k">if</span> <span class="p">(</span><span class="nx">options</span><span class="p">.</span><span class="nx">origins</span><span class="p">.</span><span class="nx">length</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="o">||</span> <span class="k">typeof</span> <span class="nx">options</span><span class="p">.</span><span class="nx">origins</span> <span class="o">===</span> <span class="s2">&quot;function&quot;</span><span class="p">)</span> <span class="p">{</span>
                                <span class="nx">res</span><span class="p">.</span><span class="nx">setHeader</span><span class="p">(</span><span class="s2">&quot;Access-Control-Allow-Origin&quot;</span><span class="p">,</span> <span class="nx">req</span><span class="p">.</span><span class="nx">headers</span><span class="p">.</span><span class="nx">origin</span><span class="p">);</span>
                            <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
                                <span class="nx">res</span><span class="p">.</span><span class="nx">setHeader</span><span class="p">(</span><span class="s2">&quot;Access-Control-Allow-Origin&quot;</span><span class="p">,</span> <span class="s2">&quot;*&quot;</span><span class="p">);</span>
                            <span class="p">}</span>
                        <span class="p">}</span></pre></div></td></tr><tr id="section-24"><td class="docs"><div class="pilwrap"><a href="#section-24" class="pilcrow">&#182;</a></div><p>If the list of exposed headers is not empty add one or more Access-Control-Expose-Headers
headers, with as values the header field names given in the list of exposed headers.</p>
</td><td class="code"><div class="highlight"><pre>                        <span class="nx">exposedHeaders</span> <span class="o">=</span> <span class="nx">options</span><span class="p">.</span><span class="nx">responseHeaders</span><span class="p">.</span><span class="nx">filter</span><span class="p">(</span><span class="kd">function</span> <span class="p">(</span><span class="nx">optionsResponseHeader</span><span class="p">)</span> <span class="p">{</span>
                            <span class="k">return</span> <span class="nx">simpleResponseHeaders</span><span class="p">.</span><span class="nx">indexOf</span><span class="p">(</span><span class="nx">optionsResponseHeader</span><span class="p">)</span> <span class="o">==</span> <span class="o">-</span><span class="mi">1</span><span class="p">;</span>
                        <span class="p">});</span>
                        <span class="k">if</span> <span class="p">(</span><span class="nx">exposedHeaders</span><span class="p">.</span><span class="nx">length</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
                            <span class="nx">res</span><span class="p">.</span><span class="nx">setHeader</span><span class="p">(</span><span class="s2">&quot;Access-Control-Expose-Headers&quot;</span><span class="p">,</span> <span class="nx">exposedHeaders</span><span class="p">.</span><span class="nx">join</span><span class="p">(</span><span class="s2">&quot;,&quot;</span><span class="p">));</span>
                        <span class="p">}</span></pre></div></td></tr><tr id="section-25"><td class="docs"><div class="pilwrap"><a href="#section-25" class="pilcrow">&#182;</a></div><p>And out.</p>
</td><td class="code"><div class="highlight"><pre>                        <span class="nx">next</span><span class="p">();</span>
                    <span class="p">}</span>
                <span class="p">}</span>
            <span class="p">});</span>
        <span class="p">}</span>
    <span class="p">};</span>
<span class="p">};</span>

</pre></div></td></tr></tbody></table><div id="generated">generated Sun Oct 06 2013 18:12:27 GMT+0200 (CEST)  </div><div id="projectname"><a href="../../index.html">Seki</a></div></div></body></html>