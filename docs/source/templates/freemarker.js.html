<!DOCTYPE html><html><head><title>freemarker.js</title><meta http-equiv="Content-Type" content="text/html" charset="UTF-8"><link rel="stylesheet" media="all" href="../docco.css"></head><body><div id="container"><div id="background"></div><div id="jump_to">Jump To &hellip;<div id="jump_wrapper"><div id="jump_page"><a href="../index.html" class="source"><span class="file_name">README</span></a><a href="../Authenticator.js.html" class="source "><span class="base_path">. / </span><span class="file_name">Authenticator.js</span></a><a href="../Bootstrap.js.html" class="source "><span class="base_path">. / </span><span class="file_name">Bootstrap.js</span></a><a href="../Dummy.js.html" class="source "><span class="base_path">. / </span><span class="file_name">Dummy.js</span></a><a href="../FileServer.js.html" class="source "><span class="base_path">. / </span><span class="file_name">FileServer.js</span></a><a href="../GetHandler.js.html" class="source "><span class="base_path">. / </span><span class="file_name">GetHandler.js</span></a><a href="../Gruntfile.js.html" class="source "><span class="base_path">. / </span><span class="file_name">Gruntfile.js</span></a><a href="../H.js.html" class="source "><span class="base_path">. / </span><span class="file_name">H.js</span></a><a href="../JSONHandler.js.html" class="source "><span class="base_path">. / </span><span class="file_name">JSONHandler.js</span></a><a href="../PostHandler.js.html" class="source "><span class="base_path">. / </span><span class="file_name">PostHandler.js</span></a><a href="../ProxyHandler.js.html" class="source "><span class="base_path">. / </span><span class="file_name">ProxyHandler.js</span></a><a href="../RequestHandler.js.html" class="source "><span class="base_path">. / </span><span class="file_name">RequestHandler.js</span></a><a href="../ResponseRenderer.js.html" class="source "><span class="base_path">. / </span><span class="file_name">ResponseRenderer.js</span></a><a href="../ScopeTest.js.html" class="source "><span class="base_path">. / </span><span class="file_name">ScopeTest.js</span></a><a href="../Seki.js.html" class="source "><span class="base_path">. / </span><span class="file_name">Seki.js</span></a><a href="../SourceHook.js.html" class="source "><span class="base_path">. / </span><span class="file_name">SourceHook.js</span></a><a href="../SparqlUtils.js.html" class="source "><span class="base_path">. / </span><span class="file_name">SparqlUtils.js</span></a><a href="../StoreClient.js.html" class="source "><span class="base_path">. / </span><span class="file_name">StoreClient.js</span></a><a href="../TryJsonld.js.html" class="source "><span class="base_path">. / </span><span class="file_name">TryJsonld.js</span></a><a href="../TurtleHandler.js.html" class="source "><span class="base_path">. / </span><span class="file_name">TurtleHandler.js</span></a><a href="../Utils.js.html" class="source "><span class="base_path">. / </span><span class="file_name">Utils.js</span></a><a href="../admin/FileReader.js.html" class="source "><span class="base_path">admin / </span><span class="file_name">FileReader.js</span></a><a href="../admin/Admin.js.html" class="source "><span class="base_path">admin / </span><span class="file_name">Admin.js</span></a><a href="../config/ConfigCustom.js.html" class="source "><span class="base_path">config / </span><span class="file_name">ConfigCustom.js</span></a><a href="../config/Constants.js.html" class="source "><span class="base_path">config / </span><span class="file_name">Constants.js</span></a><a href="../config/Headers.js.html" class="source "><span class="base_path">config / </span><span class="file_name">Headers.js</span></a><a href="../config/Special.js.html" class="source "><span class="base_path">config / </span><span class="file_name">Special.js</span></a><a href="../config/ConfigDefault.js.html" class="source "><span class="base_path">config / </span><span class="file_name">ConfigDefault.js</span></a><a href="../config/ConfigOpenShift.js.html" class="source "><span class="base_path">config / </span><span class="file_name">ConfigOpenShift.js</span></a><a href="../handlers/GetJsonHandler.js.html" class="source "><span class="base_path">handlers / </span><span class="file_name">GetJsonHandler.js</span></a><a href="../handlers/VieJsonHandler.js.html" class="source "><span class="base_path">handlers / </span><span class="file_name">VieJsonHandler.js</span></a><a href="../handlers/GetBlogHandler.js.html" class="source "><span class="base_path">handlers / </span><span class="file_name">GetBlogHandler.js</span></a><a href="../misc/sr.js.html" class="source "><span class="base_path">misc / </span><span class="file_name">sr.js</span></a><a href="../misc/biscuit.js.html" class="source "><span class="base_path">misc / </span><span class="file_name">biscuit.js</span></a><a href="../misc/router.js.html" class="source "><span class="base_path">misc / </span><span class="file_name">router.js</span></a><a href="../misc/cors-client-snippet.js.html" class="source "><span class="base_path">misc / </span><span class="file_name">cors-client-snippet.js</span></a><a href="../misc/flatten-map.js.html" class="source "><span class="base_path">misc / </span><span class="file_name">flatten-map.js</span></a><a href="../misc/mimeToJSON.js.html" class="source "><span class="base_path">misc / </span><span class="file_name">mimeToJSON.js</span></a><a href="../misc/htmlparser.js.html" class="source "><span class="base_path">misc / </span><span class="file_name">htmlparser.js</span></a><a href="../misc/shortener.js.html" class="source "><span class="base_path">misc / </span><span class="file_name">shortener.js</span></a><a href="../misc/html5-boilerplate.js.html" class="source "><span class="base_path">misc / </span><span class="file_name">html5-boilerplate.js</span></a><a href="../srx2map.js.html" class="source "><span class="base_path">. / </span><span class="file_name">srx2map.js</span></a><a href="../srx2map_multi.js.html" class="source "><span class="base_path">. / </span><span class="file_name">srx2map_multi.js</span></a><a href="../templates/SparqlTemplates.js.html" class="source "><span class="base_path">templates / </span><span class="file_name">SparqlTemplates.js</span></a><a href="../templates/JsonTemplates.js.html" class="source "><span class="base_path">templates / </span><span class="file_name">JsonTemplates.js</span></a><a href="../templates/Templater.js.html" class="source "><span class="base_path">templates / </span><span class="file_name">Templater.js</span></a><a href="../templates/SparqlUserTemplates.js.html" class="source "><span class="base_path">templates / </span><span class="file_name">SparqlUserTemplates.js</span></a><a href="../templates/HtmlTemplates.js.html" class="source "><span class="base_path">templates / </span><span class="file_name">HtmlTemplates.js</span></a><a href="../templates/freemarker.js.html" class="source selected"><span class="base_path">templates / </span><span class="file_name">freemarker.js</span></a><a href="../tests/dummyServer.js.html" class="source "><span class="base_path">tests / </span><span class="file_name">dummyServer.js</span></a><a href="../tests/run-tests.js.html" class="source "><span class="base_path">tests / </span><span class="file_name">run-tests.js</span></a><a href="../tests/TestHelpers.js.html" class="source "><span class="base_path">tests / </span><span class="file_name">TestHelpers.js</span></a><a href="../tests/test-proxy.js.html" class="source "><span class="base_path">tests / </span><span class="file_name">test-proxy.js</span></a><a href="../tests/test-entry.js.html" class="source "><span class="base_path">tests / </span><span class="file_name">test-entry.js</span></a><a href="../tests/old/allTests.js.html" class="source "><span class="base_path">tests / old / </span><span class="file_name">allTests.js</span></a><a href="../tests/old/testRdfHttp.js.html" class="source "><span class="base_path">tests / old / </span><span class="file_name">testRdfHttp.js</span></a><a href="../tests/old/testTemplater.js.html" class="source "><span class="base_path">tests / old / </span><span class="file_name">testTemplater.js</span></a><a href="../tests/old/testHelpers.js.html" class="source "><span class="base_path">tests / old / </span><span class="file_name">testHelpers.js</span></a><a href="../tests/old/api-easy/test-proxy.js.html" class="source "><span class="base_path">tests / old / api-easy / </span><span class="file_name">test-proxy.js</span></a><a href="../tests/old/api-easy/request.js.html" class="source "><span class="base_path">tests / old / api-easy / </span><span class="file_name">request.js</span></a><a href="../usermanager/users.js.html" class="source "><span class="base_path">usermanager / </span><span class="file_name">users.js</span></a><a href="../wat.js.html" class="source "><span class="base_path">. / </span><span class="file_name">wat.js</span></a></div></div></div><table cellpadding="0" cellspacing="0"><thead><tr><th class="docs"><h1>freemarker.js</h1><div class="filepath">templates/</div></th><th class="code"></th></tr></thead><tbody><tr id="section-1"><td class="docs"><div class="pilwrap"><a href="#section-1" class="pilcrow">&#182;</a></div><p>Copyright 2009 amplafi.com, Andreas Andreou</p>

<p>Licensed under the Apache License, Version 2.0 (the "License");
you may not use this file except in compliance with the License.
You may obtain a copy of the License at</p>

<pre><code>http://www.apache.org/licenses/LICENSE-2.0
</code></pre>

<p>Unless required by applicable law or agreed to in writing, software
distributed under the License is distributed on an "AS IS" BASIS,
WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
See the License for the specific language governing permissions and
limitations under the License.</p>
</td><td class="code"><div class="highlight"><pre><span class="kd">var</span> <span class="nx">freemarker</span> <span class="o">=</span> <span class="p">{</span></pre></div></td></tr><tr id="section-2"><td class="docs"><div class="pilwrap"><a href="#section-2" class="pilcrow">&#182;</a></div><p>Currently supports:
- basic interpolations
- directives:
        if, else, list 
- size builtin for arrays</p>
</td><td class="code"><div class="highlight"><pre></pre></div></td></tr><tr id="section-3"><td class="docs"><div class="pilwrap"><a href="#section-3" class="pilcrow">&#182;</a></div><p>Usage:
var engine = freemarker.create("Hello ${name}");
alert( freemarker.render(engine, {name:'Bob'}) );
// or if don't plan to reuse the engine
alert( freemarker.render("Hello ${name}", {name:'Bob'}); );</p>
</td><td class="code"><div class="highlight"><pre></pre></div></td></tr><tr id="section-4"><td class="docs"><div class="pilwrap"><a href="#section-4" class="pilcrow">&#182;</a></div><p>TODO:
- support default values, i.e. ${user!"Anonymous"}
- null resistance in above expressions if in parenthesis
- support methods, i.e. ${avg(3, 5)}
- alternative syntax if starts with [#ftl]
- ftl comments ( &lt;#-- ftl --> )
- directives elseif, switch, case, default, break, stop, compress, noparse, assign
see http://freemarker.sourceforge.net/docs/ref_directives.html
- string builtin for booleans, i.e. boolean?string("yes", "no")
- t, lt, rt, nt directives (or atleast ignore them)</p>
</td><td class="code"><div class="highlight"><pre>  <span class="nx">symbols</span><span class="o">:</span> <span class="p">{</span>  
    <span class="s1">&#39;replace&#39;</span><span class="o">:</span> <span class="p">{</span><span class="nx">start</span><span class="o">:</span><span class="s1">&#39;${&#39;</span><span class="p">,</span> <span class="nx">end</span><span class="o">:</span><span class="s1">&#39;}&#39;</span><span class="p">,</span> <span class="nx">process</span><span class="o">:</span><span class="kd">function</span><span class="p">(</span><span class="nx">parts</span><span class="p">,</span> <span class="nx">cmd</span><span class="p">)</span> <span class="p">{</span>
      <span class="nx">parts</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="nx">freemarker</span><span class="p">.</span><span class="nx">_p</span><span class="p">(</span><span class="nx">cmd</span><span class="p">));</span>
    <span class="p">}},</span>
    <span class="s1">&#39;if&#39;</span><span class="o">:</span> <span class="p">{</span><span class="nx">start</span><span class="o">:</span><span class="s1">&#39;&lt;#if&#39;</span><span class="p">,</span> <span class="nx">end</span><span class="o">:</span><span class="s1">&#39;&gt;&#39;</span><span class="p">,</span> <span class="nx">process</span><span class="o">:</span><span class="kd">function</span><span class="p">(</span><span class="nx">parts</span><span class="p">,</span> <span class="nx">cmd</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">if</span> <span class="p">(</span><span class="nx">cmd</span><span class="p">.</span><span class="nx">indexOf</span><span class="p">(</span><span class="s1">&#39;??&#39;</span><span class="p">)</span><span class="o">&gt;=</span><span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
        <span class="kd">var</span> <span class="nx">expr</span> <span class="o">=</span> <span class="nx">cmd</span><span class="p">.</span><span class="nx">substring</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nx">cmd</span><span class="p">.</span><span class="nx">length</span><span class="o">-</span><span class="mi">2</span><span class="p">);</span>
        <span class="nx">expr</span> <span class="o">=</span> <span class="nx">freemarker</span><span class="p">.</span><span class="nx">_v</span><span class="p">(</span><span class="nx">expr</span><span class="p">);</span>
        <span class="nx">parts</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="s2">&quot;if (&quot;</span> <span class="o">+</span> <span class="nx">expr</span> <span class="o">+</span> <span class="s2">&quot;) {&quot;</span><span class="p">);</span>
      <span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="nx">cmd</span><span class="p">.</span><span class="nx">indexOf</span><span class="p">(</span><span class="s1">&#39;?size&#39;</span><span class="p">)</span><span class="o">&gt;=</span><span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
        <span class="kd">var</span> <span class="nx">pos</span> <span class="o">=</span> <span class="nx">cmd</span><span class="p">.</span><span class="nx">indexOf</span><span class="p">(</span><span class="s1">&#39;?size&#39;</span><span class="p">);</span>
        <span class="kd">var</span> <span class="nx">expr</span> <span class="o">=</span> <span class="nx">freemarker</span><span class="p">.</span><span class="nx">_v</span><span class="p">(</span><span class="nx">cmd</span><span class="p">.</span><span class="nx">substring</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nx">pos</span><span class="p">))</span> <span class="o">+</span> <span class="s1">&#39;.length&#39;</span> <span class="o">+</span> <span class="nx">cmd</span><span class="p">.</span><span class="nx">substring</span><span class="p">(</span><span class="nx">pos</span><span class="o">+</span><span class="mi">5</span><span class="p">);</span>
        <span class="nx">parts</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="s2">&quot;if (&quot;</span> <span class="o">+</span> <span class="nx">expr</span> <span class="o">+</span> <span class="s2">&quot;) {&quot;</span><span class="p">);</span>
      <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
        <span class="nx">parts</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="s2">&quot;if (&quot;</span> <span class="o">+</span> <span class="nx">cmd</span> <span class="o">+</span> <span class="s2">&quot;) {&quot;</span><span class="p">);</span>
      <span class="p">}</span>
    <span class="p">}},</span>
    <span class="s1">&#39;endif&#39;</span><span class="o">:</span> <span class="p">{</span><span class="nx">start</span><span class="o">:</span><span class="s1">&#39;&lt;/#if&#39;</span><span class="p">,</span> <span class="nx">end</span><span class="o">:</span><span class="s1">&#39;&gt;&#39;</span><span class="p">,</span> <span class="nx">process</span><span class="o">:</span><span class="kd">function</span><span class="p">(</span><span class="nx">parts</span><span class="p">,</span> <span class="nx">cmd</span><span class="p">)</span> <span class="p">{</span>
      <span class="nx">parts</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="s2">&quot;}&quot;</span><span class="p">);</span>
    <span class="p">}},</span>
    <span class="s1">&#39;else&#39;</span><span class="o">:</span> <span class="p">{</span><span class="nx">start</span><span class="o">:</span><span class="s1">&#39;&lt;#else&#39;</span><span class="p">,</span> <span class="nx">end</span><span class="o">:</span><span class="s1">&#39;&gt;&#39;</span><span class="p">,</span> <span class="nx">process</span><span class="o">:</span><span class="kd">function</span><span class="p">(</span><span class="nx">parts</span><span class="p">,</span> <span class="nx">cmd</span><span class="p">)</span> <span class="p">{</span>
      <span class="nx">parts</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="s2">&quot;} else {&quot;</span><span class="p">);</span>
    <span class="p">}},</span>
    <span class="s1">&#39;list&#39;</span><span class="o">:</span> <span class="p">{</span><span class="nx">start</span><span class="o">:</span><span class="s1">&#39;&lt;#list&#39;</span><span class="p">,</span> <span class="nx">end</span><span class="o">:</span><span class="s1">&#39;&gt;&#39;</span><span class="p">,</span> <span class="nx">process</span><span class="o">:</span><span class="kd">function</span><span class="p">(</span><span class="nx">parts</span><span class="p">,</span> <span class="nx">cmd</span><span class="p">)</span> <span class="p">{</span></pre></div></td></tr><tr id="section-5"><td class="docs"><div class="pilwrap"><a href="#section-5" class="pilcrow">&#182;</a></div><p>&lt;#list envelopes as envelope ></p>
</td><td class="code"><div class="highlight"><pre>      <span class="kd">var</span> <span class="nx">match</span> <span class="o">=</span> <span class="nx">cmd</span><span class="p">.</span><span class="nx">match</span><span class="p">(</span><span class="sr">/\s*(\S*)\s*as\s*(\S*)\s*/</span><span class="p">);</span>
      <span class="k">if</span> <span class="p">(</span><span class="nx">match</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">parts</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="s2">&quot;for (var &quot;</span> <span class="o">+</span> <span class="nx">match</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">+</span> <span class="s2">&quot;_index in &quot;</span> <span class="o">+</span> <span class="nx">freemarker</span><span class="p">.</span><span class="nx">_v</span><span class="p">(</span><span class="nx">match</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span> <span class="o">+</span> <span class="s2">&quot;)&quot;</span><span class="p">);</span>
      <span class="p">}</span>
      <span class="nx">parts</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="s2">&quot;{&quot;</span><span class="p">);</span>
            <span class="k">if</span> <span class="p">(</span><span class="nx">match</span><span class="p">)</span> <span class="p">{</span>
                <span class="nx">parts</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="nx">freemarker</span><span class="p">.</span><span class="nx">_v</span><span class="p">(</span><span class="nx">match</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span> <span class="o">+</span> <span class="s2">&quot;=&quot;</span> <span class="o">+</span> <span class="nx">freemarker</span><span class="p">.</span><span class="nx">_v</span><span class="p">(</span><span class="nx">match</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span> <span class="o">+</span> <span class="s2">&quot;[&quot;</span> <span class="o">+</span> <span class="nx">match</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">+</span> <span class="s2">&quot;_index];&quot;</span><span class="p">);</span>
            <span class="p">}</span>
    <span class="p">}},</span>
    <span class="s1">&#39;endlist&#39;</span><span class="o">:</span> <span class="p">{</span><span class="nx">start</span><span class="o">:</span><span class="s1">&#39;&lt;/#list&#39;</span><span class="p">,</span> <span class="nx">end</span><span class="o">:</span><span class="s1">&#39;&gt;&#39;</span><span class="p">,</span> <span class="nx">process</span><span class="o">:</span><span class="kd">function</span><span class="p">(</span><span class="nx">parts</span><span class="p">,</span> <span class="nx">cmd</span><span class="p">)</span> <span class="p">{</span>      
      <span class="nx">parts</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="s2">&quot;}&quot;</span><span class="p">);</span>
    <span class="p">}}</span>
  <span class="p">},</span>
  <span class="nx">_o</span> <span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">cmd</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">return</span> <span class="s2">&quot;p.push(\&quot;&quot;</span> <span class="o">+</span> <span class="nx">escape</span><span class="p">(</span><span class="nx">cmd</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;\&quot;);&quot;</span><span class="p">;</span>
  <span class="p">},</span>
  <span class="nx">_p</span> <span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">cmd</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">return</span> <span class="s2">&quot;p.push(&quot;</span> <span class="o">+</span> <span class="nx">freemarker</span><span class="p">.</span><span class="nx">_v</span><span class="p">(</span><span class="nx">cmd</span><span class="p">,</span> <span class="kc">true</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;);&quot;</span><span class="p">;</span>
  <span class="p">},</span>
  <span class="nx">_d</span> <span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">cmd</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">return</span> <span class="s2">&quot;console.debug(this, \&quot;&quot;</span> <span class="o">+</span> <span class="nx">escape</span><span class="p">(</span><span class="nx">cmd</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;\&quot;);&quot;</span><span class="p">;</span>
  <span class="p">},</span>
  <span class="nx">_v</span> <span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">name</span><span class="p">,</span> <span class="nx">out</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">return</span> <span class="nx">out</span> <span class="o">?</span> <span class="s1">&#39;this._fm_out(this.&#39;</span><span class="o">+</span><span class="nx">name</span><span class="o">+</span><span class="s1">&#39;)&#39;</span> <span class="o">:</span> <span class="s1">&#39;this.&#39;</span><span class="o">+</span><span class="nx">name</span><span class="p">;</span>
  <span class="p">},</span>
  <span class="nx">_setlocalvarscode</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">obj</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">buf</span> <span class="o">=</span> <span class="p">[];</span>
    <span class="nx">buf</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="s2">&quot;this._vars={};&quot;</span><span class="p">);</span>
    <span class="k">for</span> <span class="p">(</span><span class="kd">var</span> <span class="nx">p</span> <span class="k">in</span> <span class="nx">obj</span><span class="p">)</span> <span class="p">{</span>
      <span class="nx">buf</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="s2">&quot;this._vars.&quot;</span><span class="p">,</span> <span class="nx">p</span><span class="p">,</span> <span class="s2">&quot; = this[&#39;&quot;</span><span class="p">,</span> <span class="nx">p</span><span class="p">,</span> <span class="s2">&quot;&#39;];\n&quot;</span><span class="p">);</span>
    <span class="p">}</span>
    <span class="k">return</span> <span class="nx">buf</span><span class="p">.</span><span class="nx">join</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">);</span>
  <span class="p">},</span>
  <span class="nx">nextToken</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">template</span><span class="p">,</span> <span class="nx">pos</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">newPos</span><span class="p">;</span>
    <span class="kd">var</span> <span class="nx">endPos</span><span class="p">;</span>
    <span class="kd">var</span> <span class="nx">found</span><span class="o">=</span><span class="p">{};</span>
    <span class="k">for</span> <span class="p">(</span><span class="kd">var</span> <span class="nx">i</span> <span class="k">in</span> <span class="k">this</span><span class="p">.</span><span class="nx">symbols</span><span class="p">)</span> <span class="p">{</span>
      <span class="kd">var</span> <span class="nx">symbol</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">symbols</span><span class="p">[</span><span class="nx">i</span><span class="p">];</span>
      <span class="kd">var</span> <span class="nx">n</span> <span class="o">=</span> <span class="nx">template</span><span class="p">.</span><span class="nx">indexOf</span><span class="p">(</span><span class="nx">symbol</span><span class="p">.</span><span class="nx">start</span><span class="p">,</span> <span class="nx">pos</span><span class="p">);</span>
      <span class="k">if</span> <span class="p">(</span><span class="nx">n</span><span class="o">&gt;=</span><span class="mi">0</span> <span class="o">&amp;&amp;</span> <span class="p">(</span><span class="o">!</span><span class="nx">found</span><span class="p">.</span><span class="nx">symbol</span> <span class="o">||</span> <span class="nx">n</span><span class="o">&lt;</span><span class="nx">found</span><span class="p">.</span><span class="nx">newPos</span><span class="p">))</span> <span class="p">{</span>
        <span class="kd">var</span> <span class="nx">e</span> <span class="o">=</span> <span class="nx">template</span><span class="p">.</span><span class="nx">indexOf</span><span class="p">(</span><span class="nx">symbol</span><span class="p">.</span><span class="nx">end</span><span class="p">,</span> <span class="nx">n</span><span class="p">);</span>
        <span class="k">if</span> <span class="p">(</span><span class="nx">e</span><span class="o">&gt;=</span><span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
          <span class="nx">found</span><span class="p">.</span><span class="nx">newPos</span> <span class="o">=</span> <span class="nx">n</span><span class="p">;</span>
          <span class="nx">found</span><span class="p">.</span><span class="nx">endPos</span> <span class="o">=</span> <span class="nx">e</span><span class="p">;</span>
          <span class="nx">found</span><span class="p">.</span><span class="nx">start</span> <span class="o">=</span> <span class="nx">n</span> <span class="o">+</span> <span class="nx">symbol</span><span class="p">.</span><span class="nx">start</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span>
          <span class="nx">found</span><span class="p">.</span><span class="nx">symbol</span> <span class="o">=</span> <span class="nx">symbol</span><span class="p">;</span>
        <span class="p">}</span>
      <span class="p">}</span>
    <span class="p">}</span>
    <span class="k">return</span> <span class="nx">found</span><span class="p">;</span>
  <span class="p">},</span>
  <span class="nx">create</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">template</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">parts</span> <span class="o">=</span> <span class="p">[];</span>
    <span class="nx">parts</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="s2">&quot;var p=[];&quot;</span><span class="p">);</span>
    <span class="kd">var</span> <span class="nx">pos</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span>
    <span class="k">while</span> <span class="p">(</span><span class="nx">pos</span><span class="o">&gt;=</span><span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
      <span class="kd">var</span> <span class="nx">token</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">nextToken</span><span class="p">(</span><span class="nx">template</span><span class="p">,</span> <span class="nx">pos</span><span class="p">);</span>
      <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">token</span><span class="p">.</span><span class="nx">symbol</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">parts</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">_o</span><span class="p">(</span><span class="nx">template</span><span class="p">.</span><span class="nx">substring</span><span class="p">(</span><span class="nx">pos</span><span class="p">)));</span>
        <span class="k">break</span><span class="p">;</span>
      <span class="p">}</span>
      <span class="nx">parts</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">_o</span><span class="p">(</span><span class="nx">template</span><span class="p">.</span><span class="nx">substring</span><span class="p">(</span><span class="nx">pos</span><span class="p">,</span> <span class="nx">token</span><span class="p">.</span><span class="nx">newPos</span><span class="p">)));</span>
      <span class="k">if</span> <span class="p">(</span><span class="nx">token</span><span class="p">.</span><span class="nx">symbol</span><span class="p">.</span><span class="nx">process</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">token</span><span class="p">.</span><span class="nx">symbol</span><span class="p">.</span><span class="nx">process</span><span class="p">(</span><span class="nx">parts</span><span class="p">,</span> <span class="nx">template</span><span class="p">.</span><span class="nx">substring</span><span class="p">(</span><span class="nx">token</span><span class="p">.</span><span class="nx">start</span><span class="p">,</span> <span class="nx">token</span><span class="p">.</span><span class="nx">endPos</span><span class="p">));</span>
      <span class="p">}</span>
      
      <span class="nx">pos</span> <span class="o">=</span> <span class="nx">token</span><span class="p">.</span><span class="nx">endPos</span><span class="o">+</span><span class="mi">1</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="nx">parts</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="s2">&quot;this._out = unescape(p.join(&#39;&#39;));&quot;</span><span class="p">);</span>

    <span class="kd">var</span> <span class="nx">engine</span><span class="o">=</span><span class="p">{</span>
      <span class="nx">compiled</span><span class="o">:</span><span class="nx">parts</span><span class="p">.</span><span class="nx">join</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">),</span>
      <span class="nx">template</span><span class="o">:</span><span class="nx">template</span>
    <span class="p">};</span></pre></div></td></tr><tr id="section-6"><td class="docs"><div class="pilwrap"><a href="#section-6" class="pilcrow">&#182;</a></div><p>console.debug(parts.join('\n'));</p>
</td><td class="code"><div class="highlight"><pre>    <span class="k">return</span> <span class="nx">engine</span><span class="p">;</span>
  <span class="p">},</span>

  <span class="nx">render</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">engine</span><span class="p">,</span> <span class="nx">context</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="k">typeof</span> <span class="nx">engine</span> <span class="o">==</span> <span class="s2">&quot;string&quot;</span> <span class="o">||</span> <span class="nx">engine</span> <span class="k">instanceof</span> <span class="nb">String</span><span class="p">)</span> <span class="p">{</span>
      <span class="nx">engine</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">create</span><span class="p">(</span><span class="nx">engine</span><span class="p">);</span>
    <span class="p">}</span>
    <span class="nx">context</span> <span class="o">=</span> <span class="nx">context</span> <span class="o">||</span> <span class="p">{};</span>
    <span class="nx">context</span><span class="p">.</span><span class="nx">_fm_out</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">val</span><span class="p">){</span>
      <span class="k">if</span> <span class="p">(</span><span class="k">typeof</span> <span class="nx">val</span> <span class="o">==</span> <span class="s1">&#39;object&#39;</span><span class="p">){</span>
        <span class="k">if</span> <span class="p">(</span><span class="k">typeof</span> <span class="nx">val</span><span class="p">.</span><span class="nx">_render</span> <span class="o">==</span> <span class="s1">&#39;function&#39;</span><span class="p">)</span>
          <span class="k">return</span> <span class="nx">val</span><span class="p">.</span><span class="nx">_render</span><span class="p">();</span>
        <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="nx">val</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
          <span class="k">return</span> <span class="nx">val</span><span class="p">[</span><span class="mi">0</span><span class="p">];</span>        
      <span class="p">}</span> 

      <span class="k">return</span> <span class="nx">val</span><span class="p">;</span>
    <span class="p">};</span>
    <span class="kd">var</span> <span class="nx">vars</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">_setlocalvarscode</span><span class="p">(</span><span class="nx">context</span><span class="p">);</span></pre></div></td></tr><tr id="section-7"><td class="docs"><div class="pilwrap"><a href="#section-7" class="pilcrow">&#182;</a></div><p>(function(){eval(vars+engine.compiled);}).call(context);</p>
</td><td class="code"><div class="highlight"><pre>    <span class="p">(</span><span class="kd">function</span><span class="p">(){</span><span class="nb">eval</span><span class="p">(</span><span class="nx">engine</span><span class="p">.</span><span class="nx">compiled</span><span class="p">);}).</span><span class="nx">call</span><span class="p">(</span><span class="nx">context</span><span class="p">);</span>
    <span class="k">return</span> <span class="nx">context</span><span class="p">.</span><span class="nx">_out</span><span class="p">;</span>
  <span class="p">}</span>
<span class="p">};</span> 

<span class="nx">module</span><span class="p">.</span><span class="nx">exports</span> <span class="o">=</span> <span class="nx">freemarker</span><span class="p">;</span>

</pre></div></td></tr></tbody></table><div id="generated">generated Fri Oct 11 2013 19:17:26 GMT+0200 (CEST)  </div><div id="projectname"><a href="../index.html">Seki</a></div></div></body></html>