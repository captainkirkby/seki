<!DOCTYPE html><html><head><title>htmlparser.js</title><meta http-equiv="Content-Type" content="text/html" charset="UTF-8"><link rel="stylesheet" media="all" href="../docco.css"></head><body><div id="container"><div id="background"></div><div id="jump_to">Jump To &hellip;<div id="jump_wrapper"><div id="jump_page"><a href="../index.html" class="source"><span class="file_name">README</span></a><a href="../Authenticator.js.html" class="source "><span class="base_path">. / </span><span class="file_name">Authenticator.js</span></a><a href="../Bootstrap.js.html" class="source "><span class="base_path">. / </span><span class="file_name">Bootstrap.js</span></a><a href="../Dummy.js.html" class="source "><span class="base_path">. / </span><span class="file_name">Dummy.js</span></a><a href="../FileServer.js.html" class="source "><span class="base_path">. / </span><span class="file_name">FileServer.js</span></a><a href="../GetHandler.js.html" class="source "><span class="base_path">. / </span><span class="file_name">GetHandler.js</span></a><a href="../Gruntfile.js.html" class="source "><span class="base_path">. / </span><span class="file_name">Gruntfile.js</span></a><a href="../H.js.html" class="source "><span class="base_path">. / </span><span class="file_name">H.js</span></a><a href="../JSONHandler.js.html" class="source "><span class="base_path">. / </span><span class="file_name">JSONHandler.js</span></a><a href="../PostHandler.js.html" class="source "><span class="base_path">. / </span><span class="file_name">PostHandler.js</span></a><a href="../ProxyHandler.js.html" class="source "><span class="base_path">. / </span><span class="file_name">ProxyHandler.js</span></a><a href="../RequestHandler.js.html" class="source "><span class="base_path">. / </span><span class="file_name">RequestHandler.js</span></a><a href="../ResponseRenderer.js.html" class="source "><span class="base_path">. / </span><span class="file_name">ResponseRenderer.js</span></a><a href="../ScopeTest.js.html" class="source "><span class="base_path">. / </span><span class="file_name">ScopeTest.js</span></a><a href="../Seki.js.html" class="source "><span class="base_path">. / </span><span class="file_name">Seki.js</span></a><a href="../SourceHook.js.html" class="source "><span class="base_path">. / </span><span class="file_name">SourceHook.js</span></a><a href="../SparqlUtils.js.html" class="source "><span class="base_path">. / </span><span class="file_name">SparqlUtils.js</span></a><a href="../StoreClient.js.html" class="source "><span class="base_path">. / </span><span class="file_name">StoreClient.js</span></a><a href="../TryJsonld.js.html" class="source "><span class="base_path">. / </span><span class="file_name">TryJsonld.js</span></a><a href="../TurtleHandler.js.html" class="source "><span class="base_path">. / </span><span class="file_name">TurtleHandler.js</span></a><a href="../Utils.js.html" class="source "><span class="base_path">. / </span><span class="file_name">Utils.js</span></a><a href="../admin/FileReader.js.html" class="source "><span class="base_path">admin / </span><span class="file_name">FileReader.js</span></a><a href="../admin/Admin.js.html" class="source "><span class="base_path">admin / </span><span class="file_name">Admin.js</span></a><a href="../config/ConfigCustom.js.html" class="source "><span class="base_path">config / </span><span class="file_name">ConfigCustom.js</span></a><a href="../config/Constants.js.html" class="source "><span class="base_path">config / </span><span class="file_name">Constants.js</span></a><a href="../config/Headers.js.html" class="source "><span class="base_path">config / </span><span class="file_name">Headers.js</span></a><a href="../config/Special.js.html" class="source "><span class="base_path">config / </span><span class="file_name">Special.js</span></a><a href="../config/ConfigDefault.js.html" class="source "><span class="base_path">config / </span><span class="file_name">ConfigDefault.js</span></a><a href="../config/ConfigOpenShift.js.html" class="source "><span class="base_path">config / </span><span class="file_name">ConfigOpenShift.js</span></a><a href="../handlers/GetJsonHandler.js.html" class="source "><span class="base_path">handlers / </span><span class="file_name">GetJsonHandler.js</span></a><a href="../handlers/VieJsonHandler.js.html" class="source "><span class="base_path">handlers / </span><span class="file_name">VieJsonHandler.js</span></a><a href="../handlers/GetBlogHandler.js.html" class="source "><span class="base_path">handlers / </span><span class="file_name">GetBlogHandler.js</span></a><a href="../misc/sr.js.html" class="source "><span class="base_path">misc / </span><span class="file_name">sr.js</span></a><a href="../misc/biscuit.js.html" class="source "><span class="base_path">misc / </span><span class="file_name">biscuit.js</span></a><a href="../misc/router.js.html" class="source "><span class="base_path">misc / </span><span class="file_name">router.js</span></a><a href="../misc/cors-client-snippet.js.html" class="source "><span class="base_path">misc / </span><span class="file_name">cors-client-snippet.js</span></a><a href="../misc/flatten-map.js.html" class="source "><span class="base_path">misc / </span><span class="file_name">flatten-map.js</span></a><a href="../misc/mimeToJSON.js.html" class="source "><span class="base_path">misc / </span><span class="file_name">mimeToJSON.js</span></a><a href="../misc/htmlparser.js.html" class="source selected"><span class="base_path">misc / </span><span class="file_name">htmlparser.js</span></a><a href="../misc/shortener.js.html" class="source "><span class="base_path">misc / </span><span class="file_name">shortener.js</span></a><a href="../misc/html5-boilerplate.js.html" class="source "><span class="base_path">misc / </span><span class="file_name">html5-boilerplate.js</span></a><a href="../srx2map.js.html" class="source "><span class="base_path">. / </span><span class="file_name">srx2map.js</span></a><a href="../srx2map_multi.js.html" class="source "><span class="base_path">. / </span><span class="file_name">srx2map_multi.js</span></a><a href="../templates/SparqlTemplates.js.html" class="source "><span class="base_path">templates / </span><span class="file_name">SparqlTemplates.js</span></a><a href="../templates/JsonTemplates.js.html" class="source "><span class="base_path">templates / </span><span class="file_name">JsonTemplates.js</span></a><a href="../templates/Templater.js.html" class="source "><span class="base_path">templates / </span><span class="file_name">Templater.js</span></a><a href="../templates/SparqlUserTemplates.js.html" class="source "><span class="base_path">templates / </span><span class="file_name">SparqlUserTemplates.js</span></a><a href="../templates/HtmlTemplates.js.html" class="source "><span class="base_path">templates / </span><span class="file_name">HtmlTemplates.js</span></a><a href="../templates/freemarker.js.html" class="source "><span class="base_path">templates / </span><span class="file_name">freemarker.js</span></a><a href="../tests/dummyServer.js.html" class="source "><span class="base_path">tests / </span><span class="file_name">dummyServer.js</span></a><a href="../tests/run-tests.js.html" class="source "><span class="base_path">tests / </span><span class="file_name">run-tests.js</span></a><a href="../tests/TestHelpers.js.html" class="source "><span class="base_path">tests / </span><span class="file_name">TestHelpers.js</span></a><a href="../tests/test-proxy.js.html" class="source "><span class="base_path">tests / </span><span class="file_name">test-proxy.js</span></a><a href="../tests/test-entry.js.html" class="source "><span class="base_path">tests / </span><span class="file_name">test-entry.js</span></a><a href="../tests/old/allTests.js.html" class="source "><span class="base_path">tests / old / </span><span class="file_name">allTests.js</span></a><a href="../tests/old/testRdfHttp.js.html" class="source "><span class="base_path">tests / old / </span><span class="file_name">testRdfHttp.js</span></a><a href="../tests/old/testTemplater.js.html" class="source "><span class="base_path">tests / old / </span><span class="file_name">testTemplater.js</span></a><a href="../tests/old/testHelpers.js.html" class="source "><span class="base_path">tests / old / </span><span class="file_name">testHelpers.js</span></a><a href="../tests/old/api-easy/test-proxy.js.html" class="source "><span class="base_path">tests / old / api-easy / </span><span class="file_name">test-proxy.js</span></a><a href="../tests/old/api-easy/request.js.html" class="source "><span class="base_path">tests / old / api-easy / </span><span class="file_name">request.js</span></a><a href="../usermanager/users.js.html" class="source "><span class="base_path">usermanager / </span><span class="file_name">users.js</span></a><a href="../wat.js.html" class="source "><span class="base_path">. / </span><span class="file_name">wat.js</span></a></div></div></div><table cellpadding="0" cellspacing="0"><thead><tr><th class="docs"><h1>htmlparser.js</h1><div class="filepath">misc/</div></th><th class="code"></th></tr></thead><tbody><tr id="section-1"><td class="docs"><div class="pilwrap"><a href="#section-1" class="pilcrow">&#182;</a></div><div class="dox"><div class="summary"><p>HTML Parser By John Resig (ejohn.org)<br />Original code by Erik Arvidsson, Mozilla Public License<br /><a href='http://erik.eae.net/simplehtmlparser/simplehtmlparser.js'>http://erik.eae.net/simplehtmlparser/simplehtmlparser.js</a></p></div><div class="body"><p>// Use like so:<br />HTMLParser(htmlString, {<br />    start: function(tag, attrs, unary) {},<br />    end: function(tag) {},<br />    chars: function(text) {},<br />    comment: function(text) {}<br />});</p>

<p>// or to get an XML string:<br />HTMLtoXML(htmlString);</p>

<p>// or to get an XML DOM Document<br />HTMLtoDOM(htmlString);</p>

<p>// or to inject into an existing document/DOM node<br />HTMLtoDOM(htmlString, document);<br />HTMLtoDOM(htmlString, document.body);</p></div></div>
</td><td class="code"><div class="highlight"><pre><span class="p">(</span><span class="kd">function</span><span class="p">(){</span></pre></div></td></tr><tr id="section-2"><td class="docs"><div class="pilwrap"><a href="#section-2" class="pilcrow">&#182;</a></div><p>Regular Expressions for parsing tags and attributes</p>
</td><td class="code"><div class="highlight"><pre>  <span class="kd">var</span> <span class="nx">startTag</span> <span class="o">=</span> <span class="sr">/^&lt;([-A-Za-z0-9_]+)((?:\s+\w+(?:\s*=\s*(?:(?:&quot;[^&quot;]*&quot;)|(?:&#39;[^&#39;]*&#39;)|[^&gt;\s]+))?)*)\s*(\/?)&gt;/</span><span class="p">,</span>
    <span class="nx">endTag</span> <span class="o">=</span> <span class="sr">/^&lt;\/([-A-Za-z0-9_]+)[^&gt;]*&gt;/</span><span class="p">,</span>
    <span class="nx">attr</span> <span class="o">=</span> <span class="sr">/([-A-Za-z0-9_]+)(?:\s*=\s*(?:(?:&quot;((?:\\.|[^&quot;])*)&quot;)|(?:&#39;((?:\\.|[^&#39;])*)&#39;)|([^&gt;\s]+)))?/g</span><span class="p">;</span>
    </pre></div></td></tr><tr id="section-3"><td class="docs"><div class="pilwrap"><a href="#section-3" class="pilcrow">&#182;</a></div><p>Empty Elements - HTML 4.01</p>
</td><td class="code"><div class="highlight"><pre>  <span class="kd">var</span> <span class="nx">empty</span> <span class="o">=</span> <span class="nx">makeMap</span><span class="p">(</span><span class="s2">&quot;area,base,basefont,br,col,frame,hr,img,input,isindex,link,meta,param,embed&quot;</span><span class="p">);</span></pre></div></td></tr><tr id="section-4"><td class="docs"><div class="pilwrap"><a href="#section-4" class="pilcrow">&#182;</a></div><p>Block Elements - HTML 4.01</p>
</td><td class="code"><div class="highlight"><pre>  <span class="kd">var</span> <span class="nx">block</span> <span class="o">=</span> <span class="nx">makeMap</span><span class="p">(</span><span class="s2">&quot;address,applet,blockquote,button,center,dd,del,dir,div,dl,dt,fieldset,form,frameset,hr,iframe,ins,isindex,li,map,menu,noframes,noscript,object,ol,p,pre,script,table,tbody,td,tfoot,th,thead,tr,ul&quot;</span><span class="p">);</span></pre></div></td></tr><tr id="section-5"><td class="docs"><div class="pilwrap"><a href="#section-5" class="pilcrow">&#182;</a></div><p>Inline Elements - HTML 4.01</p>
</td><td class="code"><div class="highlight"><pre>  <span class="kd">var</span> <span class="nx">inline</span> <span class="o">=</span> <span class="nx">makeMap</span><span class="p">(</span><span class="s2">&quot;a,abbr,acronym,applet,b,basefont,bdo,big,br,button,cite,code,del,dfn,em,font,i,iframe,img,input,ins,kbd,label,map,object,q,s,samp,script,select,small,span,strike,strong,sub,sup,textarea,tt,u,var&quot;</span><span class="p">);</span></pre></div></td></tr><tr id="section-6"><td class="docs"><div class="pilwrap"><a href="#section-6" class="pilcrow">&#182;</a></div><p>Elements that you can, intentionally, leave open
(and which close themselves)</p>
</td><td class="code"><div class="highlight"><pre>  <span class="kd">var</span> <span class="nx">closeSelf</span> <span class="o">=</span> <span class="nx">makeMap</span><span class="p">(</span><span class="s2">&quot;colgroup,dd,dt,li,options,p,td,tfoot,th,thead,tr&quot;</span><span class="p">);</span></pre></div></td></tr><tr id="section-7"><td class="docs"><div class="pilwrap"><a href="#section-7" class="pilcrow">&#182;</a></div><p>Attributes that have their values filled in disabled="disabled"</p>
</td><td class="code"><div class="highlight"><pre>  <span class="kd">var</span> <span class="nx">fillAttrs</span> <span class="o">=</span> <span class="nx">makeMap</span><span class="p">(</span><span class="s2">&quot;checked,compact,declare,defer,disabled,ismap,multiple,nohref,noresize,noshade,nowrap,readonly,selected&quot;</span><span class="p">);</span></pre></div></td></tr><tr id="section-8"><td class="docs"><div class="pilwrap"><a href="#section-8" class="pilcrow">&#182;</a></div><p>Special Elements (can contain anything)</p>
</td><td class="code"><div class="highlight"><pre>  <span class="kd">var</span> <span class="nx">special</span> <span class="o">=</span> <span class="nx">makeMap</span><span class="p">(</span><span class="s2">&quot;script,style&quot;</span><span class="p">);</span>

  <span class="kd">var</span> <span class="nx">HTMLParser</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">HTMLParser</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span> <span class="nx">html</span><span class="p">,</span> <span class="nx">handler</span> <span class="p">)</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">index</span><span class="p">,</span> <span class="nx">chars</span><span class="p">,</span> <span class="nx">match</span><span class="p">,</span> <span class="nx">stack</span> <span class="o">=</span> <span class="p">[],</span> <span class="nx">last</span> <span class="o">=</span> <span class="nx">html</span><span class="p">;</span>
    <span class="nx">stack</span><span class="p">.</span><span class="nx">last</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(){</span>
      <span class="k">return</span> <span class="k">this</span><span class="p">[</span> <span class="k">this</span><span class="p">.</span><span class="nx">length</span> <span class="o">-</span> <span class="mi">1</span> <span class="p">];</span>
    <span class="p">};</span>

    <span class="k">while</span> <span class="p">(</span> <span class="nx">html</span> <span class="p">)</span> <span class="p">{</span>
      <span class="nx">chars</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span></pre></div></td></tr><tr id="section-9"><td class="docs"><div class="pilwrap"><a href="#section-9" class="pilcrow">&#182;</a></div><p>Make sure we're not in a script or style element</p>
</td><td class="code"><div class="highlight"><pre>      <span class="k">if</span> <span class="p">(</span> <span class="o">!</span><span class="nx">stack</span><span class="p">.</span><span class="nx">last</span><span class="p">()</span> <span class="o">||</span> <span class="o">!</span><span class="nx">special</span><span class="p">[</span> <span class="nx">stack</span><span class="p">.</span><span class="nx">last</span><span class="p">()</span> <span class="p">]</span> <span class="p">)</span> <span class="p">{</span></pre></div></td></tr><tr id="section-10"><td class="docs"><div class="pilwrap"><a href="#section-10" class="pilcrow">&#182;</a></div><p>Comment</p>
</td><td class="code"><div class="highlight"><pre>        <span class="k">if</span> <span class="p">(</span> <span class="nx">html</span><span class="p">.</span><span class="nx">indexOf</span><span class="p">(</span><span class="s2">&quot;&lt;!--&quot;</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span> <span class="p">)</span> <span class="p">{</span>
          <span class="nx">index</span> <span class="o">=</span> <span class="nx">html</span><span class="p">.</span><span class="nx">indexOf</span><span class="p">(</span><span class="s2">&quot;--&gt;&quot;</span><span class="p">);</span>
  
          <span class="k">if</span> <span class="p">(</span> <span class="nx">index</span> <span class="o">&gt;=</span> <span class="mi">0</span> <span class="p">)</span> <span class="p">{</span>
            <span class="k">if</span> <span class="p">(</span> <span class="nx">handler</span><span class="p">.</span><span class="nx">comment</span> <span class="p">)</span>
              <span class="nx">handler</span><span class="p">.</span><span class="nx">comment</span><span class="p">(</span> <span class="nx">html</span><span class="p">.</span><span class="nx">substring</span><span class="p">(</span> <span class="mi">4</span><span class="p">,</span> <span class="nx">index</span> <span class="p">)</span> <span class="p">);</span>
            <span class="nx">html</span> <span class="o">=</span> <span class="nx">html</span><span class="p">.</span><span class="nx">substring</span><span class="p">(</span> <span class="nx">index</span> <span class="o">+</span> <span class="mi">3</span> <span class="p">);</span>
            <span class="nx">chars</span> <span class="o">=</span> <span class="kc">false</span><span class="p">;</span>
          <span class="p">}</span>
  </pre></div></td></tr><tr id="section-11"><td class="docs"><div class="pilwrap"><a href="#section-11" class="pilcrow">&#182;</a></div><p>end tag</p>
</td><td class="code"><div class="highlight"><pre>        <span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span> <span class="nx">html</span><span class="p">.</span><span class="nx">indexOf</span><span class="p">(</span><span class="s2">&quot;&lt;/&quot;</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span> <span class="p">)</span> <span class="p">{</span>
          <span class="nx">match</span> <span class="o">=</span> <span class="nx">html</span><span class="p">.</span><span class="nx">match</span><span class="p">(</span> <span class="nx">endTag</span> <span class="p">);</span>
  
          <span class="k">if</span> <span class="p">(</span> <span class="nx">match</span> <span class="p">)</span> <span class="p">{</span>
            <span class="nx">html</span> <span class="o">=</span> <span class="nx">html</span><span class="p">.</span><span class="nx">substring</span><span class="p">(</span> <span class="nx">match</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="nx">length</span> <span class="p">);</span>
            <span class="nx">match</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="nx">replace</span><span class="p">(</span> <span class="nx">endTag</span><span class="p">,</span> <span class="nx">parseEndTag</span> <span class="p">);</span>
            <span class="nx">chars</span> <span class="o">=</span> <span class="kc">false</span><span class="p">;</span>
          <span class="p">}</span>
  </pre></div></td></tr><tr id="section-12"><td class="docs"><div class="pilwrap"><a href="#section-12" class="pilcrow">&#182;</a></div><p>start tag</p>
</td><td class="code"><div class="highlight"><pre>        <span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span> <span class="nx">html</span><span class="p">.</span><span class="nx">indexOf</span><span class="p">(</span><span class="s2">&quot;&lt;&quot;</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span> <span class="p">)</span> <span class="p">{</span>
          <span class="nx">match</span> <span class="o">=</span> <span class="nx">html</span><span class="p">.</span><span class="nx">match</span><span class="p">(</span> <span class="nx">startTag</span> <span class="p">);</span>
  
          <span class="k">if</span> <span class="p">(</span> <span class="nx">match</span> <span class="p">)</span> <span class="p">{</span>
            <span class="nx">html</span> <span class="o">=</span> <span class="nx">html</span><span class="p">.</span><span class="nx">substring</span><span class="p">(</span> <span class="nx">match</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="nx">length</span> <span class="p">);</span>
            <span class="nx">match</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="nx">replace</span><span class="p">(</span> <span class="nx">startTag</span><span class="p">,</span> <span class="nx">parseStartTag</span> <span class="p">);</span>
            <span class="nx">chars</span> <span class="o">=</span> <span class="kc">false</span><span class="p">;</span>
          <span class="p">}</span>
        <span class="p">}</span>

        <span class="k">if</span> <span class="p">(</span> <span class="nx">chars</span> <span class="p">)</span> <span class="p">{</span>
          <span class="nx">index</span> <span class="o">=</span> <span class="nx">html</span><span class="p">.</span><span class="nx">indexOf</span><span class="p">(</span><span class="s2">&quot;&lt;&quot;</span><span class="p">);</span>
          
          <span class="kd">var</span> <span class="nx">text</span> <span class="o">=</span> <span class="nx">index</span> <span class="o">&lt;</span> <span class="mi">0</span> <span class="o">?</span> <span class="nx">html</span> <span class="o">:</span> <span class="nx">html</span><span class="p">.</span><span class="nx">substring</span><span class="p">(</span> <span class="mi">0</span><span class="p">,</span> <span class="nx">index</span> <span class="p">);</span>
          <span class="nx">html</span> <span class="o">=</span> <span class="nx">index</span> <span class="o">&lt;</span> <span class="mi">0</span> <span class="o">?</span> <span class="s2">&quot;&quot;</span> <span class="o">:</span> <span class="nx">html</span><span class="p">.</span><span class="nx">substring</span><span class="p">(</span> <span class="nx">index</span> <span class="p">);</span>
          
          <span class="k">if</span> <span class="p">(</span> <span class="nx">handler</span><span class="p">.</span><span class="nx">chars</span> <span class="p">)</span>
            <span class="nx">handler</span><span class="p">.</span><span class="nx">chars</span><span class="p">(</span> <span class="nx">text</span> <span class="p">);</span>
        <span class="p">}</span>

      <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
        <span class="nx">html</span> <span class="o">=</span> <span class="nx">html</span><span class="p">.</span><span class="nx">replace</span><span class="p">(</span><span class="k">new</span> <span class="nb">RegExp</span><span class="p">(</span><span class="s2">&quot;(.*)&lt;\/&quot;</span> <span class="o">+</span> <span class="nx">stack</span><span class="p">.</span><span class="nx">last</span><span class="p">()</span> <span class="o">+</span> <span class="s2">&quot;[^&gt;]*&gt;&quot;</span><span class="p">),</span> <span class="kd">function</span><span class="p">(</span><span class="nx">all</span><span class="p">,</span> <span class="nx">text</span><span class="p">){</span>
          <span class="nx">text</span> <span class="o">=</span> <span class="nx">text</span><span class="p">.</span><span class="nx">replace</span><span class="p">(</span><span class="sr">/&lt;!--(.*?)--&gt;/g</span><span class="p">,</span> <span class="s2">&quot;$1&quot;</span><span class="p">)</span>
            <span class="p">.</span><span class="nx">replace</span><span class="p">(</span><span class="sr">/&lt;!\[CDATA\[(.*?)]]&gt;/g</span><span class="p">,</span> <span class="s2">&quot;$1&quot;</span><span class="p">);</span>

          <span class="k">if</span> <span class="p">(</span> <span class="nx">handler</span><span class="p">.</span><span class="nx">chars</span> <span class="p">)</span>
            <span class="nx">handler</span><span class="p">.</span><span class="nx">chars</span><span class="p">(</span> <span class="nx">text</span> <span class="p">);</span>

          <span class="k">return</span> <span class="s2">&quot;&quot;</span><span class="p">;</span>
        <span class="p">});</span>

        <span class="nx">parseEndTag</span><span class="p">(</span> <span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="nx">stack</span><span class="p">.</span><span class="nx">last</span><span class="p">()</span> <span class="p">);</span>
      <span class="p">}</span>

      <span class="k">if</span> <span class="p">(</span> <span class="nx">html</span> <span class="o">==</span> <span class="nx">last</span> <span class="p">)</span>
        <span class="k">throw</span> <span class="s2">&quot;Parse Error: &quot;</span> <span class="o">+</span> <span class="nx">html</span><span class="p">;</span>
      <span class="nx">last</span> <span class="o">=</span> <span class="nx">html</span><span class="p">;</span>
    <span class="p">}</span>
    </pre></div></td></tr><tr id="section-13"><td class="docs"><div class="pilwrap"><a href="#section-13" class="pilcrow">&#182;</a></div><p>Clean up any remaining tags</p>
</td><td class="code"><div class="highlight"><pre>    <span class="nx">parseEndTag</span><span class="p">();</span>

    <span class="kd">function</span> <span class="nx">parseStartTag</span><span class="p">(</span> <span class="nx">tag</span><span class="p">,</span> <span class="nx">tagName</span><span class="p">,</span> <span class="nx">rest</span><span class="p">,</span> <span class="nx">unary</span> <span class="p">)</span> <span class="p">{</span>
      <span class="nx">tagName</span> <span class="o">=</span> <span class="nx">tagName</span><span class="p">.</span><span class="nx">toLowerCase</span><span class="p">();</span>

      <span class="k">if</span> <span class="p">(</span> <span class="nx">block</span><span class="p">[</span> <span class="nx">tagName</span> <span class="p">]</span> <span class="p">)</span> <span class="p">{</span>
        <span class="k">while</span> <span class="p">(</span> <span class="nx">stack</span><span class="p">.</span><span class="nx">last</span><span class="p">()</span> <span class="o">&amp;&amp;</span> <span class="nx">inline</span><span class="p">[</span> <span class="nx">stack</span><span class="p">.</span><span class="nx">last</span><span class="p">()</span> <span class="p">]</span> <span class="p">)</span> <span class="p">{</span>
          <span class="nx">parseEndTag</span><span class="p">(</span> <span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="nx">stack</span><span class="p">.</span><span class="nx">last</span><span class="p">()</span> <span class="p">);</span>
        <span class="p">}</span>
      <span class="p">}</span>

      <span class="k">if</span> <span class="p">(</span> <span class="nx">closeSelf</span><span class="p">[</span> <span class="nx">tagName</span> <span class="p">]</span> <span class="o">&amp;&amp;</span> <span class="nx">stack</span><span class="p">.</span><span class="nx">last</span><span class="p">()</span> <span class="o">==</span> <span class="nx">tagName</span> <span class="p">)</span> <span class="p">{</span>
        <span class="nx">parseEndTag</span><span class="p">(</span> <span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="nx">tagName</span> <span class="p">);</span>
      <span class="p">}</span>

      <span class="nx">unary</span> <span class="o">=</span> <span class="nx">empty</span><span class="p">[</span> <span class="nx">tagName</span> <span class="p">]</span> <span class="o">||</span> <span class="o">!!</span><span class="nx">unary</span><span class="p">;</span>

      <span class="k">if</span> <span class="p">(</span> <span class="o">!</span><span class="nx">unary</span> <span class="p">)</span>
        <span class="nx">stack</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span> <span class="nx">tagName</span> <span class="p">);</span>
      
      <span class="k">if</span> <span class="p">(</span> <span class="nx">handler</span><span class="p">.</span><span class="nx">start</span> <span class="p">)</span> <span class="p">{</span>
        <span class="kd">var</span> <span class="nx">attrs</span> <span class="o">=</span> <span class="p">[];</span>
  
        <span class="nx">rest</span><span class="p">.</span><span class="nx">replace</span><span class="p">(</span><span class="nx">attr</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">match</span><span class="p">,</span> <span class="nx">name</span><span class="p">)</span> <span class="p">{</span>
          <span class="kd">var</span> <span class="nx">value</span> <span class="o">=</span> <span class="nx">arguments</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">?</span> <span class="nx">arguments</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">:</span>
            <span class="nx">arguments</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="o">?</span> <span class="nx">arguments</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="o">:</span>
            <span class="nx">arguments</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span> <span class="o">?</span> <span class="nx">arguments</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span> <span class="o">:</span>
            <span class="nx">fillAttrs</span><span class="p">[</span><span class="nx">name</span><span class="p">]</span> <span class="o">?</span> <span class="nx">name</span> <span class="o">:</span> <span class="s2">&quot;&quot;</span><span class="p">;</span>
          
          <span class="nx">attrs</span><span class="p">.</span><span class="nx">push</span><span class="p">({</span>
            <span class="nx">name</span><span class="o">:</span> <span class="nx">name</span><span class="p">,</span>
            <span class="nx">value</span><span class="o">:</span> <span class="nx">value</span><span class="p">,</span>
            <span class="nx">escaped</span><span class="o">:</span> <span class="nx">value</span><span class="p">.</span><span class="nx">replace</span><span class="p">(</span><span class="sr">/(^|[^\\])&quot;/g</span><span class="p">,</span> <span class="s1">&#39;$1\\\&quot;&#39;</span><span class="p">)</span> <span class="c1">//&quot;</span>
          <span class="p">});</span>
        <span class="p">});</span>
  
        <span class="k">if</span> <span class="p">(</span> <span class="nx">handler</span><span class="p">.</span><span class="nx">start</span> <span class="p">)</span>
          <span class="nx">handler</span><span class="p">.</span><span class="nx">start</span><span class="p">(</span> <span class="nx">tagName</span><span class="p">,</span> <span class="nx">attrs</span><span class="p">,</span> <span class="nx">unary</span> <span class="p">);</span>
      <span class="p">}</span>
    <span class="p">}</span>

    <span class="kd">function</span> <span class="nx">parseEndTag</span><span class="p">(</span> <span class="nx">tag</span><span class="p">,</span> <span class="nx">tagName</span> <span class="p">)</span> <span class="p">{</span></pre></div></td></tr><tr id="section-14"><td class="docs"><div class="pilwrap"><a href="#section-14" class="pilcrow">&#182;</a></div><p>If no tag name is provided, clean shop</p>
</td><td class="code"><div class="highlight"><pre>      <span class="k">if</span> <span class="p">(</span> <span class="o">!</span><span class="nx">tagName</span> <span class="p">)</span>
        <span class="kd">var</span> <span class="nx">pos</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
        </pre></div></td></tr><tr id="section-15"><td class="docs"><div class="pilwrap"><a href="#section-15" class="pilcrow">&#182;</a></div><p>Find the closest opened tag of the same type</p>
</td><td class="code"><div class="highlight"><pre>      <span class="k">else</span>
        <span class="k">for</span> <span class="p">(</span> <span class="kd">var</span> <span class="nx">pos</span> <span class="o">=</span> <span class="nx">stack</span><span class="p">.</span><span class="nx">length</span> <span class="o">-</span> <span class="mi">1</span><span class="p">;</span> <span class="nx">pos</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">;</span> <span class="nx">pos</span><span class="o">--</span> <span class="p">)</span>
          <span class="k">if</span> <span class="p">(</span> <span class="nx">stack</span><span class="p">[</span> <span class="nx">pos</span> <span class="p">]</span> <span class="o">==</span> <span class="nx">tagName</span> <span class="p">)</span>
            <span class="k">break</span><span class="p">;</span>
      
      <span class="k">if</span> <span class="p">(</span> <span class="nx">pos</span> <span class="o">&gt;=</span> <span class="mi">0</span> <span class="p">)</span> <span class="p">{</span></pre></div></td></tr><tr id="section-16"><td class="docs"><div class="pilwrap"><a href="#section-16" class="pilcrow">&#182;</a></div><p>Close all the open elements, up the stack</p>
</td><td class="code"><div class="highlight"><pre>        <span class="k">for</span> <span class="p">(</span> <span class="kd">var</span> <span class="nx">i</span> <span class="o">=</span> <span class="nx">stack</span><span class="p">.</span><span class="nx">length</span> <span class="o">-</span> <span class="mi">1</span><span class="p">;</span> <span class="nx">i</span> <span class="o">&gt;=</span> <span class="nx">pos</span><span class="p">;</span> <span class="nx">i</span><span class="o">--</span> <span class="p">)</span>
          <span class="k">if</span> <span class="p">(</span> <span class="nx">handler</span><span class="p">.</span><span class="nx">end</span> <span class="p">)</span>
            <span class="nx">handler</span><span class="p">.</span><span class="nx">end</span><span class="p">(</span> <span class="nx">stack</span><span class="p">[</span> <span class="nx">i</span> <span class="p">]</span> <span class="p">);</span>
        </pre></div></td></tr><tr id="section-17"><td class="docs"><div class="pilwrap"><a href="#section-17" class="pilcrow">&#182;</a></div><p>Remove the open elements from the stack</p>
</td><td class="code"><div class="highlight"><pre>        <span class="nx">stack</span><span class="p">.</span><span class="nx">length</span> <span class="o">=</span> <span class="nx">pos</span><span class="p">;</span>
      <span class="p">}</span>
    <span class="p">}</span>
  <span class="p">};</span>
  
  <span class="k">this</span><span class="p">.</span><span class="nx">HTMLtoXML</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span> <span class="nx">html</span> <span class="p">)</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">results</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span><span class="p">;</span>
    
    <span class="nx">HTMLParser</span><span class="p">(</span><span class="nx">html</span><span class="p">,</span> <span class="p">{</span>
      <span class="nx">start</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span> <span class="nx">tag</span><span class="p">,</span> <span class="nx">attrs</span><span class="p">,</span> <span class="nx">unary</span> <span class="p">)</span> <span class="p">{</span>
        <span class="nx">results</span> <span class="o">+=</span> <span class="s2">&quot;&lt;&quot;</span> <span class="o">+</span> <span class="nx">tag</span><span class="p">;</span>
    
        <span class="k">for</span> <span class="p">(</span> <span class="kd">var</span> <span class="nx">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="nx">i</span> <span class="o">&lt;</span> <span class="nx">attrs</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span> <span class="nx">i</span><span class="o">++</span> <span class="p">)</span>
          <span class="nx">results</span> <span class="o">+=</span> <span class="s2">&quot; &quot;</span> <span class="o">+</span> <span class="nx">attrs</span><span class="p">[</span><span class="nx">i</span><span class="p">].</span><span class="nx">name</span> <span class="o">+</span> <span class="s1">&#39;=&quot;&#39;</span> <span class="o">+</span> <span class="nx">attrs</span><span class="p">[</span><span class="nx">i</span><span class="p">].</span><span class="nx">escaped</span> <span class="o">+</span> <span class="s1">&#39;&quot;&#39;</span><span class="p">;</span>
    
        <span class="nx">results</span> <span class="o">+=</span> <span class="p">(</span><span class="nx">unary</span> <span class="o">?</span> <span class="s2">&quot;/&quot;</span> <span class="o">:</span> <span class="s2">&quot;&quot;</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;&gt;&quot;</span><span class="p">;</span>
      <span class="p">},</span>
      <span class="nx">end</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span> <span class="nx">tag</span> <span class="p">)</span> <span class="p">{</span>
        <span class="nx">results</span> <span class="o">+=</span> <span class="s2">&quot;&lt;/&quot;</span> <span class="o">+</span> <span class="nx">tag</span> <span class="o">+</span> <span class="s2">&quot;&gt;&quot;</span><span class="p">;</span>
      <span class="p">},</span>
      <span class="nx">chars</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span> <span class="nx">text</span> <span class="p">)</span> <span class="p">{</span>
        <span class="nx">results</span> <span class="o">+=</span> <span class="nx">text</span><span class="p">;</span>
      <span class="p">},</span>
      <span class="nx">comment</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span> <span class="nx">text</span> <span class="p">)</span> <span class="p">{</span>
        <span class="nx">results</span> <span class="o">+=</span> <span class="s2">&quot;&lt;!--&quot;</span> <span class="o">+</span> <span class="nx">text</span> <span class="o">+</span> <span class="s2">&quot;--&gt;&quot;</span><span class="p">;</span>
      <span class="p">}</span>
    <span class="p">});</span>
    
    <span class="k">return</span> <span class="nx">results</span><span class="p">;</span>
  <span class="p">};</span>
  
  <span class="k">this</span><span class="p">.</span><span class="nx">HTMLtoDOM</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span> <span class="nx">html</span><span class="p">,</span> <span class="nx">doc</span> <span class="p">)</span> <span class="p">{</span></pre></div></td></tr><tr id="section-18"><td class="docs"><div class="pilwrap"><a href="#section-18" class="pilcrow">&#182;</a></div><p>There can be only one of these elements</p>
</td><td class="code"><div class="highlight"><pre>    <span class="kd">var</span> <span class="nx">one</span> <span class="o">=</span> <span class="nx">makeMap</span><span class="p">(</span><span class="s2">&quot;html,head,body,title&quot;</span><span class="p">);</span>
    </pre></div></td></tr><tr id="section-19"><td class="docs"><div class="pilwrap"><a href="#section-19" class="pilcrow">&#182;</a></div><p>Enforce a structure for the document</p>
</td><td class="code"><div class="highlight"><pre>    <span class="kd">var</span> <span class="nx">structure</span> <span class="o">=</span> <span class="p">{</span>
      <span class="nx">link</span><span class="o">:</span> <span class="s2">&quot;head&quot;</span><span class="p">,</span>
      <span class="nx">base</span><span class="o">:</span> <span class="s2">&quot;head&quot;</span>
    <span class="p">};</span>
  
    <span class="k">if</span> <span class="p">(</span> <span class="o">!</span><span class="nx">doc</span> <span class="p">)</span> <span class="p">{</span>
      <span class="k">if</span> <span class="p">(</span> <span class="k">typeof</span> <span class="nx">DOMDocument</span> <span class="o">!=</span> <span class="s2">&quot;undefined&quot;</span> <span class="p">)</span>
        <span class="nx">doc</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">DOMDocument</span><span class="p">();</span>
      <span class="k">else</span> <span class="k">if</span> <span class="p">(</span> <span class="k">typeof</span> <span class="nb">document</span> <span class="o">!=</span> <span class="s2">&quot;undefined&quot;</span> <span class="o">&amp;&amp;</span> <span class="nb">document</span><span class="p">.</span><span class="nx">implementation</span> <span class="o">&amp;&amp;</span> <span class="nb">document</span><span class="p">.</span><span class="nx">implementation</span><span class="p">.</span><span class="nx">createDocument</span> <span class="p">)</span>
        <span class="nx">doc</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">implementation</span><span class="p">.</span><span class="nx">createDocument</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="kc">null</span><span class="p">);</span>
      <span class="k">else</span> <span class="k">if</span> <span class="p">(</span> <span class="k">typeof</span> <span class="nx">ActiveX</span> <span class="o">!=</span> <span class="s2">&quot;undefined&quot;</span> <span class="p">)</span>
        <span class="nx">doc</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">ActiveXObject</span><span class="p">(</span><span class="s2">&quot;Msxml.DOMDocument&quot;</span><span class="p">);</span>
      
    <span class="p">}</span> <span class="k">else</span>
      <span class="nx">doc</span> <span class="o">=</span> <span class="nx">doc</span><span class="p">.</span><span class="nx">ownerDocument</span> <span class="o">||</span>
        <span class="nx">doc</span><span class="p">.</span><span class="nx">getOwnerDocument</span> <span class="o">&amp;&amp;</span> <span class="nx">doc</span><span class="p">.</span><span class="nx">getOwnerDocument</span><span class="p">()</span> <span class="o">||</span>
        <span class="nx">doc</span><span class="p">;</span>
    
    <span class="kd">var</span> <span class="nx">elems</span> <span class="o">=</span> <span class="p">[],</span>
      <span class="nx">documentElement</span> <span class="o">=</span> <span class="nx">doc</span><span class="p">.</span><span class="nx">documentElement</span> <span class="o">||</span>
        <span class="nx">doc</span><span class="p">.</span><span class="nx">getDocumentElement</span> <span class="o">&amp;&amp;</span> <span class="nx">doc</span><span class="p">.</span><span class="nx">getDocumentElement</span><span class="p">();</span>
        </pre></div></td></tr><tr id="section-20"><td class="docs"><div class="pilwrap"><a href="#section-20" class="pilcrow">&#182;</a></div><p>If we're dealing with an empty document then we
need to pre-populate it with the HTML document structure</p>
</td><td class="code"><div class="highlight"><pre>    <span class="k">if</span> <span class="p">(</span> <span class="o">!</span><span class="nx">documentElement</span> <span class="o">&amp;&amp;</span> <span class="nx">doc</span><span class="p">.</span><span class="nx">createElement</span> <span class="p">)</span> <span class="p">(</span><span class="kd">function</span><span class="p">(){</span>
      <span class="kd">var</span> <span class="nx">html</span> <span class="o">=</span> <span class="nx">doc</span><span class="p">.</span><span class="nx">createElement</span><span class="p">(</span><span class="s2">&quot;html&quot;</span><span class="p">);</span>
      <span class="kd">var</span> <span class="nx">head</span> <span class="o">=</span> <span class="nx">doc</span><span class="p">.</span><span class="nx">createElement</span><span class="p">(</span><span class="s2">&quot;head&quot;</span><span class="p">);</span>
      <span class="nx">head</span><span class="p">.</span><span class="nx">appendChild</span><span class="p">(</span> <span class="nx">doc</span><span class="p">.</span><span class="nx">createElement</span><span class="p">(</span><span class="s2">&quot;title&quot;</span><span class="p">)</span> <span class="p">);</span>
      <span class="nx">html</span><span class="p">.</span><span class="nx">appendChild</span><span class="p">(</span> <span class="nx">head</span> <span class="p">);</span>
      <span class="nx">html</span><span class="p">.</span><span class="nx">appendChild</span><span class="p">(</span> <span class="nx">doc</span><span class="p">.</span><span class="nx">createElement</span><span class="p">(</span><span class="s2">&quot;body&quot;</span><span class="p">)</span> <span class="p">);</span>
      <span class="nx">doc</span><span class="p">.</span><span class="nx">appendChild</span><span class="p">(</span> <span class="nx">html</span> <span class="p">);</span>
    <span class="p">})();</span>
    </pre></div></td></tr><tr id="section-21"><td class="docs"><div class="pilwrap"><a href="#section-21" class="pilcrow">&#182;</a></div><p>Find all the unique elements</p>
</td><td class="code"><div class="highlight"><pre>    <span class="k">if</span> <span class="p">(</span> <span class="nx">doc</span><span class="p">.</span><span class="nx">getElementsByTagName</span> <span class="p">)</span>
      <span class="k">for</span> <span class="p">(</span> <span class="kd">var</span> <span class="nx">i</span> <span class="k">in</span> <span class="nx">one</span> <span class="p">)</span>
        <span class="nx">one</span><span class="p">[</span> <span class="nx">i</span> <span class="p">]</span> <span class="o">=</span> <span class="nx">doc</span><span class="p">.</span><span class="nx">getElementsByTagName</span><span class="p">(</span> <span class="nx">i</span> <span class="p">)[</span><span class="mi">0</span><span class="p">];</span>
    </pre></div></td></tr><tr id="section-22"><td class="docs"><div class="pilwrap"><a href="#section-22" class="pilcrow">&#182;</a></div><p>If we're working with a document, inject contents into
the body element</p>
</td><td class="code"><div class="highlight"><pre>    <span class="kd">var</span> <span class="nx">curParentNode</span> <span class="o">=</span> <span class="nx">one</span><span class="p">.</span><span class="nx">body</span><span class="p">;</span>
    
    <span class="nx">HTMLParser</span><span class="p">(</span> <span class="nx">html</span><span class="p">,</span> <span class="p">{</span>
      <span class="nx">start</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span> <span class="nx">tagName</span><span class="p">,</span> <span class="nx">attrs</span><span class="p">,</span> <span class="nx">unary</span> <span class="p">)</span> <span class="p">{</span></pre></div></td></tr><tr id="section-23"><td class="docs"><div class="pilwrap"><a href="#section-23" class="pilcrow">&#182;</a></div><p>If it's a pre-built element, then we can ignore
its construction</p>
</td><td class="code"><div class="highlight"><pre>        <span class="k">if</span> <span class="p">(</span> <span class="nx">one</span><span class="p">[</span> <span class="nx">tagName</span> <span class="p">]</span> <span class="p">)</span> <span class="p">{</span>
          <span class="nx">curParentNode</span> <span class="o">=</span> <span class="nx">one</span><span class="p">[</span> <span class="nx">tagName</span> <span class="p">];</span>
          <span class="k">if</span> <span class="p">(</span> <span class="o">!</span><span class="nx">unary</span> <span class="p">)</span> <span class="p">{</span>
            <span class="nx">elems</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span> <span class="nx">curParentNode</span> <span class="p">);</span>
          <span class="p">}</span>
          <span class="k">return</span><span class="p">;</span>
        <span class="p">}</span>
      
        <span class="kd">var</span> <span class="nx">elem</span> <span class="o">=</span> <span class="nx">doc</span><span class="p">.</span><span class="nx">createElement</span><span class="p">(</span> <span class="nx">tagName</span> <span class="p">);</span>
        
        <span class="k">for</span> <span class="p">(</span> <span class="kd">var</span> <span class="nx">attr</span> <span class="k">in</span> <span class="nx">attrs</span> <span class="p">)</span>
          <span class="nx">elem</span><span class="p">.</span><span class="nx">setAttribute</span><span class="p">(</span> <span class="nx">attrs</span><span class="p">[</span> <span class="nx">attr</span> <span class="p">].</span><span class="nx">name</span><span class="p">,</span> <span class="nx">attrs</span><span class="p">[</span> <span class="nx">attr</span> <span class="p">].</span><span class="nx">value</span> <span class="p">);</span>
        
        <span class="k">if</span> <span class="p">(</span> <span class="nx">structure</span><span class="p">[</span> <span class="nx">tagName</span> <span class="p">]</span> <span class="o">&amp;&amp;</span> <span class="k">typeof</span> <span class="nx">one</span><span class="p">[</span> <span class="nx">structure</span><span class="p">[</span> <span class="nx">tagName</span> <span class="p">]</span> <span class="p">]</span> <span class="o">!=</span> <span class="s2">&quot;boolean&quot;</span> <span class="p">)</span>
          <span class="nx">one</span><span class="p">[</span> <span class="nx">structure</span><span class="p">[</span> <span class="nx">tagName</span> <span class="p">]</span> <span class="p">].</span><span class="nx">appendChild</span><span class="p">(</span> <span class="nx">elem</span> <span class="p">);</span>
        
        <span class="k">else</span> <span class="k">if</span> <span class="p">(</span> <span class="nx">curParentNode</span> <span class="o">&amp;&amp;</span> <span class="nx">curParentNode</span><span class="p">.</span><span class="nx">appendChild</span> <span class="p">)</span>
          <span class="nx">curParentNode</span><span class="p">.</span><span class="nx">appendChild</span><span class="p">(</span> <span class="nx">elem</span> <span class="p">);</span>
          
        <span class="k">if</span> <span class="p">(</span> <span class="o">!</span><span class="nx">unary</span> <span class="p">)</span> <span class="p">{</span>
          <span class="nx">elems</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span> <span class="nx">elem</span> <span class="p">);</span>
          <span class="nx">curParentNode</span> <span class="o">=</span> <span class="nx">elem</span><span class="p">;</span>
        <span class="p">}</span>
      <span class="p">},</span>
      <span class="nx">end</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span> <span class="nx">tag</span> <span class="p">)</span> <span class="p">{</span>
        <span class="nx">elems</span><span class="p">.</span><span class="nx">length</span> <span class="o">-=</span> <span class="mi">1</span><span class="p">;</span>
        </pre></div></td></tr><tr id="section-24"><td class="docs"><div class="pilwrap"><a href="#section-24" class="pilcrow">&#182;</a></div><p>Init the new parentNode</p>
</td><td class="code"><div class="highlight"><pre>        <span class="nx">curParentNode</span> <span class="o">=</span> <span class="nx">elems</span><span class="p">[</span> <span class="nx">elems</span><span class="p">.</span><span class="nx">length</span> <span class="o">-</span> <span class="mi">1</span> <span class="p">];</span>
      <span class="p">},</span>
      <span class="nx">chars</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span> <span class="nx">text</span> <span class="p">)</span> <span class="p">{</span>
        <span class="nx">curParentNode</span><span class="p">.</span><span class="nx">appendChild</span><span class="p">(</span> <span class="nx">doc</span><span class="p">.</span><span class="nx">createTextNode</span><span class="p">(</span> <span class="nx">text</span> <span class="p">)</span> <span class="p">);</span>
      <span class="p">},</span>
      <span class="nx">comment</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span> <span class="nx">text</span> <span class="p">)</span> <span class="p">{</span></pre></div></td></tr><tr id="section-25"><td class="docs"><div class="pilwrap"><a href="#section-25" class="pilcrow">&#182;</a></div><p>create comment node</p>
</td><td class="code"><div class="highlight"><pre>      <span class="p">}</span>
    <span class="p">});</span>
    
    <span class="k">return</span> <span class="nx">doc</span><span class="p">;</span>
  <span class="p">};</span>

  <span class="kd">function</span> <span class="nx">makeMap</span><span class="p">(</span><span class="nx">str</span><span class="p">){</span>
    <span class="kd">var</span> <span class="nx">obj</span> <span class="o">=</span> <span class="p">{},</span> <span class="nx">items</span> <span class="o">=</span> <span class="nx">str</span><span class="p">.</span><span class="nx">split</span><span class="p">(</span><span class="s2">&quot;,&quot;</span><span class="p">);</span>
    <span class="k">for</span> <span class="p">(</span> <span class="kd">var</span> <span class="nx">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="nx">i</span> <span class="o">&lt;</span> <span class="nx">items</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span> <span class="nx">i</span><span class="o">++</span> <span class="p">)</span>
      <span class="nx">obj</span><span class="p">[</span> <span class="nx">items</span><span class="p">[</span><span class="nx">i</span><span class="p">]</span> <span class="p">]</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span>
    <span class="k">return</span> <span class="nx">obj</span><span class="p">;</span>
  <span class="p">}</span>
<span class="p">})();</span>

</pre></div></td></tr></tbody></table><div id="generated">generated Fri Oct 11 2013 19:17:24 GMT+0200 (CEST)  </div><div id="projectname"><a href="../index.html">Seki</a></div></div></body></html>